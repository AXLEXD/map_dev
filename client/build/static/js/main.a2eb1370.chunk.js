(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{17:function(e,t,n){},19:function(e,t,n){},21:function(e,t,n){"use strict";n.r(t);var a=n(0),i=n.n(a),s=n(7),c=n.n(s),o=(n(17),n(4)),r=n(3),l=n(5),u=n(1),h=n(2),f=(n(19),[{blockid:0,blockname:"1",imagesrc:"#ffffff"},{blockid:1,blockname:"2",imagesrc:"#d1e7dc"},{blockid:2,blockname:"3",imagesrc:"#c4d4e1"},{blockid:3,blockname:"4",imagesrc:"#bcb5d3"},{blockid:4,blockname:"5",imagesrc:"#f5dbe2"},{blockid:5,blockname:"6",imagesrc:"#eeb6c9"},{blockid:6,blockname:"7",imagesrc:"#c49abf"},{blockid:7,blockname:"8",imagesrc:"#bada55"},{blockid:8,blockname:"9",imagesrc:"#ffd700"},{blockid:9,blockname:"10",imagesrc:"#f47b79"}]);function d(e,t,n,a,i){var s=n-e,c=a-t,o=1;c<0&&(o=-1,c=-c);for(var r=2*c-s,l=t,u=e;u<n+1;u++)i(u,l),r>0?(l+=o,r+=2*(c-s)):r+=2*c}function m(e,t,n,a,i){var s=n-e,c=a-t,o=1;s<0&&(o=-1,s=-s);for(var r=2*s-c,l=e,u=t;u<a+1;u++)i(l,u),r>0?(l+=o,r+=2*(s-c)):r+=2*s}var v=function(){function e(t,n){Object(u.a)(this,e),this.x=t,this.y=n}return Object(h.a)(e,[{key:"transform",value:function(e,t){this.x+=e,this.y+=t}},{key:"setTo",value:function(e,t){this.x=e,this.y=t}},{key:"isEqualTo",value:function(e){return this.x===e.x&&this.y===e.y}},{key:"notEqualTo",value:function(e){return this.x!==e.x||this.y!==e.y}},{key:"positive",value:function(){return this.x>=0&&this.y>=0}},{key:"multipliedby",value:function(t){return new e(this.x*t,this.y*t)}},{key:"transformedby",value:function(t,n){return new e(this.x+t,this.y+n)}}]),e}(),p=function(){function e(t,n,a){Object(u.a)(this,e),this.canvasdimensions=new v(t,n),this.chunksize=a,this.matrix=null,this.lastchunkrequesttime=null}return Object(h.a)(e,[{key:"getValues",value:function(e,t){var n=new v(0,0),a=new v(0,0);return a.x=0===e.x?0:Math.floor(-1*e.x/t),a.y=0===e.y?0:Math.floor(-1*e.y/t),n.x=Math.ceil(this.canvasdimensions.x/t)+1,n.y=Math.ceil(this.canvasdimensions.y/t)+1,{startpoint:a,numchunks:n}}},{key:"setMatrix",value:function(e,t,n){for(var a=[],i=Array(e.x),s=0;s<e.x;s++){i[s]=Array(e.y);for(var c=0;c<e.x;c++){var o={x:t.x+s,y:t.y+c};a.push(o)}}var r=this;return new Promise(function(s,c){fetch("/getchunks",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({coords:a,lines:n})}).then(function(e){return e.json()}).then(function(n){for(var a=0;a<e.x;a++)for(var c=0;c<e.y;c++){var o=n["".concat(a+t.x,",").concat(c+t.y)];i[a][c]=void 0!==o?new g(r.chunksize,a+t.x,c+t.y,o.chunkdata.split("")):new g(r.chunksize,a+t.x,c+t.y)}r.matrix=i,s()})})}},{key:"getChunkPosOffset",value:function(e,t,n){var a=Math.floor(e.x/t)-n.x,i=e.x-(a+n.x)*t,s=Math.floor(e.y/t)-n.y;return{cell_i:a,cell_j:s,cell_k:i,cell_l:e.y-(s+n.y)*t}}}]),e}(),g=function(){function e(t,n,a){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];Object(u.a)(this,e),this.x=n,this.y=a,i.length?this.modified_cells=i:this.modified_cells=Array(t*t).fill("0")}return Object(h.a)(e,[{key:"addCell",value:function(e,t,n){this.modified_cells[16*e+t]=n,this.modified=!0}}]),e}(),k=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(o.a)(this,Object(r.a)(t).call(this,e))).state={block_selected:1,update_time:0,tot_update_time:0,num_updates:1,cursorx:0,cursory:0,offsetx:0,offsety:0},n.changeBlock=function(e){n.setState({block_selected:e})},n.getBlockSelected=function(){return n.state.block_selected},n.isSelected=function(e){return e===n.state.block_selected},n.changeUpdateTime=function(e){n.setState({update_time:e,tot_update_time:n.state.tot_update_time+e,num_updates:n.state.num_updates+1})},n.changeCursorLoc=function(e){n.setState({cursorx:e.x,cursory:e.y})},n.changeOffsetLoc=function(e){n.setState({offsetx:e.x,offsety:e.y})},n}return Object(l.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){document.body.style.overflow="hidden",this.getData()}},{key:"getData",value:function(){var e=this;fetch("/api").then(function(e){return e.json()}).then(function(t){return e.setState({express_data:t.message})})}},{key:"render",value:function(){return i.a.createElement("div",{className:"App-wrapper"},i.a.createElement(y,{changeUpdateTime:this.changeUpdateTime,getBlockSelected:this.getBlockSelected,changeCursorLoc:this.changeCursorLoc,changeOffsetLoc:this.changeOffsetLoc}),i.a.createElement(b,{isSelected:this.isSelected,changeBlock:this.changeBlock}),i.a.createElement("div",{className:"drawer primary"},i.a.createElement("div",{style:{position:"absolute",right:"0.8vw"}},"(",this.state.update_time,"ms, avg: ",Math.round(this.state.tot_update_time/this.state.num_updates),"ms, ",this.state.num_updates," updates)",i.a.createElement("br",null),"Cursor: (",this.state.cursorx,",",this.state.cursory,")",i.a.createElement("br",null),"Offset: (",this.state.offsetx,",",this.state.offsety,")"),i.a.createElement("b",null,"Instructions:"),i.a.createElement("br",null),"This is a pixel art canvas with infinite area. Scroll to zoom in and out, right click to pan around, and use left click to draw on the canvas.",i.a.createElement("br",null),"Use the palette on the right to select your colour.",i.a.createElement("div",{style:{color:"#909090"}},"(!!!!) Be aware that there is no saving yet lol, also this is just a prototype so limited colours, no drawing tools etc.")))}}]),t}(i.a.Component),y=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(o.a)(this,Object(r.a)(t).call(this,e))).getBlockSelected=e.getBlockSelected,n.changeUpdateTime=e.changeUpdateTime,n.changeCursorLoc=e.changeCursorLoc,n.changeOffsetLoc=e.changeOffsetLoc,n.lastChunkFetchTime=0,n.lastDrawSendTime=0,n.drawLines=[],n.cellsize=8,n.scale=2,n.chunksize=16,n.map_grid=null,n.canvasRef=Object(a.createRef)(),n.mapoffset=new v(0,0),n.celloffset=new v(0,0),n.currentcell=new v(0,0),n.startpoint=new v(0,0),n.numchunks=new v(0,0),n.cursorcurrent=new v(0,0),n.lmousedown=!1,n.rmousedown=!1,n.canvas=null,n}return Object(l.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.canvas=this.canvasRef.current;var t=this.canvas.getBoundingClientRect(),n=t.width,a=t.height;this.map_grid=new p(n,a,this.chunksize),this.chunkinterval=setTimeout(function(){return e.updateCanvas(!0)},1e3)}},{key:"getCursorPosition",value:function(e,t){var n=t.getBoundingClientRect(),a=e.clientX-n.left,i=e.clientY-n.top;return new v(a,i)}},{key:"getCurrentCell",value:function(){var e=Math.floor((this.cursorcurrent.x-this.mapoffset.x*this.scale)/(this.cellsize*this.scale)),t=Math.floor((this.cursorcurrent.y-this.mapoffset.y*this.scale)/(this.cellsize*this.scale));return new v(e,t)}},{key:"moveMap",value:function(e,t){var n=(t.x-e.x)/this.scale,a=(t.y-e.y)/this.scale;this.mapoffset.transform(n,a),this.celloffset.setTo(Math.floor(this.mapoffset.x/this.cellsize),Math.floor(this.mapoffset.y/this.cellsize)),this.changeOffsetLoc(this.celloffset)}},{key:"drawMap",value:function(e,t){var n=this;this.resizeCanvas(e);var a=e.getContext("2d");a.clearRect(0,0,e.width,e.height),a.fillStyle="#ffffff",a.fillRect(0,0,e.width,e.height);var i,s,c,o=this.cellsize*this.scale,r=this.map_grid.getChunkPosOffset(this.currentcell,this.chunksize,t),l=r.cell_i,u=r.cell_j,h=r.cell_k,d=r.cell_l,m=function(e,i,r,l){s=((e+t.x)*n.chunksize+r)*o+n.mapoffset.x*n.scale,c=((i+t.y)*n.chunksize+l)*o+n.mapoffset.y*n.scale,a.fillRect(s,c,o,o)};if(null!==this.map_grid.matrix){for(var v=0;v<this.map_grid.matrix.length;v++)for(var p=0;p<this.map_grid.matrix[v].length;p++)for(var g=0;g<this.chunksize*this.chunksize;g++){var k=Math.floor(g/this.chunksize),y=g-k*this.chunksize;"undefined"!==typeof this.map_grid.matrix[v][p]&&("0"!==(i=this.map_grid.matrix[v][p].modified_cells[g])&&(a.fillStyle=f[i].imagesrc,m(v,p,k,y)))}a.fillStyle=f[this.getBlockSelected()].imagesrc+"8f",m(l,u,h,d)}}},{key:"updateCanvas",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=Date.now();if(Date.now()>=this.lastChunkFetchTime+1e3){this.lastChunkFetchTime=Date.now();var a=this.map_grid.getValues(this.mapoffset.multipliedby(this.scale),this.chunksize*this.cellsize*this.scale),i=a.startpoint,s=a.numchunks;if(t){var c=this.drawLines;this.drawLines=[],this.map_grid.setMatrix(s,i,c).then(function(){null!==e.map_grid.matrix&&e.drawMap(e.canvas,i),e.startpoint=i,e.numchunks=s,e.changeUpdateTime(Date.now()-n)})}else this.drawMap(this.canvas,i)}setTimeout(function(){e.updateCanvas(!0)},1e3)}},{key:"resizeCanvas",value:function(e){var t=e.getBoundingClientRect(),n=t.width,a=t.height;if(e.width!==n||e.height!==a){var i=window.devicePixelRatio,s=void 0===i?1:i,c=e.getContext("2d");return e.width=n*s,e.height=a*s,c.scale(s,s),!0}return!1}},{key:"drawCellAtMouse",value:function(e,t){var n=new v(e-this.celloffset.x,t-this.celloffset.y),a=this.map_grid.getChunkPosOffset(n,this.chunksize,this.startpoint),i=a.cell_i,s=a.cell_j,c=a.cell_k,o=a.cell_l;void 0!==this.map_grid.matrix[i][s]&&this.map_grid.matrix[i][s].addCell(c,o,this.getBlockSelected())}},{key:"moveCursor",value:function(e){var t=!1,n=this.getCursorPosition(e,this.canvas);this.rmousedown&&(this.moveMap(this.cursorcurrent,n),t=!0),this.cursorcurrent=n;var a=this.getCurrentCell();return this.currentcell.isEqualTo(a)||(this.lmousedown&&this.drawLine(this.currentcell,a),this.currentcell=a,t=!0,this.changeCursorLoc(this.currentcell)),t}},{key:"drawLine",value:function(e,t){var n=this;!function(e,t,n,a){var i=e.x+n.x,s=e.y+n.y,c=t.x+n.x,o=t.y+n.y;i===c&&s===o&&a(i,s),Math.abs(o-s)<Math.abs(c-i)?i>c?d(c,o,i,s,a):d(i,s,c,o,a):s>o?m(c,o,i,s,a):m(i,s,c,o,a)}(e,t,this.celloffset,function(e,t){return n.drawCellAtMouse(e,t)}),this.drawLines.push({p1:e,p2:t,offset:this.celloffset,blockid:this.getBlockSelected()})}},{key:"render",value:function(){var e=this;return i.a.createElement("div",null,i.a.createElement("canvas",{ref:this.canvasRef,className:"map-canvas primary",onContextMenu:function(e){e.preventDefault()},onMouseDown:function(t){t.preventDefault(),0===t.button?(e.lmousedown=!0,e.drawLine(e.currentcell,e.currentcell),e.drawMap(e.canvas,e.startpoint)):2===t.button&&(e.rmousedown=!0)},onMouseUp:function(t){e.lmousedown=!1,e.rmousedown=!1,e.drawMap(e.canvas,e.startpoint)},onMouseMove:function(t){e.moveCursor(t)&&e.drawMap(e.canvas,e.startpoint)},onMouseLeave:function(t){e.moveCursor(t),e.lmousedown=!1,e.rmousedown=!1,e.drawMap(e.canvas,e.startpoint)},onWheel:function(t){t.preventDefault();var n=e.scale-Math.round(t.deltaY)/1e3,a=e.scale;if(n>.5){e.scale=n;var i=e.canvas.getBoundingClientRect(),s=i.width/2,c=i.height/2;e.moveMap(new v(0,0),new v(s-s*(e.scale-a),c-c*(e.scale-a)))}else e.scale=.5;e.drawMap(e.canvas,e.startpoint)}}))}}]),t}(i.a.Component),b=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(o.a)(this,Object(r.a)(t).call(this,e))).changeBlock=e.changeBlock,n}return Object(l.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){var e=this;return i.a.createElement("div",{className:"palette primary"},f.map(function(t){return i.a.createElement("div",{key:t.blockid,style:{backgroundColor:"".concat(t.imagesrc)},className:"blockbutton"+(e.props.isSelected(t.blockid)?"selected":""),onClick:function(){e.changeBlock(t.blockid)}})}))}}]),t}(i.a.Component);var w=function(){return i.a.createElement("div",{className:"App"},i.a.createElement(k,null))},x=function(e){e&&e instanceof Function&&n.e(1).then(n.bind(null,22)).then(function(t){var n=t.getCLS,a=t.getFID,i=t.getFCP,s=t.getLCP,c=t.getTTFB;n(e),a(e),i(e),s(e),c(e)})};c.a.createRoot(document.getElementById("root")).render(i.a.createElement(i.a.StrictMode,null,i.a.createElement(w,null))),x()},8:function(e,t,n){e.exports=n(21)}},[[8,3,2]]]);
//# sourceMappingURL=main.a2eb1370.chunk.js.map