(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{17:function(e,t,o){},18:function(e,t,o){},19:function(e,t,o){"use strict";o.r(t);var a=o(0),n=o.n(a),s=o(7),i=o.n(s),c=(o(17),o(4)),r=o(3),l=o(5),u=o(1),h=o(2),d=(o(18),0),f=2,m=[{blockid:"0",blockname:"1",imagesrc:"#ffffff"},{blockid:"1",blockname:"2",imagesrc:"#d1e7dc"},{blockid:"2",blockname:"3",imagesrc:"#c4d4e1"},{blockid:"3",blockname:"4",imagesrc:"#bcb5d3"},{blockid:"4",blockname:"5",imagesrc:"#f5dbe2"},{blockid:"5",blockname:"6",imagesrc:"#eeb6c9"},{blockid:"6",blockname:"7",imagesrc:"#c49abf"},{blockid:"7",blockname:"8",imagesrc:"#bada55"},{blockid:"8",blockname:"9",imagesrc:"#ffd700"},{blockid:"9",blockname:"10",imagesrc:"#f47b79"},{blockid:"a",blockname:"11",imagesrc:"#c6e2d4"},{blockid:"b",blockname:"12",imagesrc:"#b6d3c2"},{blockid:"c",blockname:"13",imagesrc:"#e0b1cb"},{blockid:"d",blockname:"14",imagesrc:"#d0a7b7"},{blockid:"e",blockname:"15",imagesrc:"#f3d1d3"},{blockid:"f",blockname:"16",imagesrc:"#e9b8c8"}];function p(e,t,o,a,n){var s=o-e,i=a-t,c=1;i<0&&(c=-1,i=-i);for(var r=2*i-s,l=t,u=e;u<o+1;u++)n(u,l),r>0?(l+=c,r+=2*(i-s)):r+=2*i}function g(e,t,o,a,n){var s=o-e,i=a-t,c=1;s<0&&(c=-1,s=-s);for(var r=2*s-i,l=e,u=t;u<a+1;u++)n(l,u),r>0?(l+=c,r+=2*(s-i)):r+=2*s}var v=function(){function e(t,o){Object(u.a)(this,e),this.x=t,this.y=o}return Object(h.a)(e,[{key:"transform",value:function(e,t){this.x+=e,this.y+=t}},{key:"setTo",value:function(e,t){this.x=e,this.y=t}},{key:"isEqualTo",value:function(e){return this.x===e.x&&this.y===e.y}},{key:"notEqualTo",value:function(e){return this.x!==e.x||this.y!==e.y}},{key:"positive",value:function(){return this.x>=0&&this.y>=0}},{key:"multipliedby",value:function(t){return new e(this.x*t,this.y*t)}},{key:"transformedby",value:function(t,o){return new e(this.x+t,this.y+o)}}]),e}(),b=function(){function e(){Object(u.a)(this,e),this.data=null,this.dataview=null,this.numchunks=null}return Object(h.a)(e,[{key:"getValues",value:function(e,t,o){var a=16*o,n=new v(0,0),s=new v(0,0);s.x=0===t.x?0:Math.floor(-1*t.x/a),s.y=0===t.y?0:Math.floor(-1*t.y/a);var i=e.getBoundingClientRect(),c=i.width,r=i.height;return n.x=Math.ceil(c/a)+1,n.y=Math.ceil(r/a)+1,{startpoint:s,numchunks:n}}},{key:"setMatrix",value:function(e,t,o){for(var a=[],n=this,s=0;s<e.x;s++)for(var i=0;i<e.y;i++){var c={x:t.x+s,y:t.y+i};a.push(c)}return new Promise(function(t,s){fetch("/getchunks",{method:"POST",headers:{Accept:"application/octet-stream","Content-Type":"application/json"},body:JSON.stringify({coords:a,lines:o})}).then(function(e){return e.arrayBuffer()}).then(function(o){n.data=o,n.dataview=new Uint32Array(n.data),n.numchunks=e,t()})})}},{key:"getChunkPosOffset",value:function(e,t){var o=Math.floor(e.x/16)-t.x,a=e.x-16*(o+t.x),n=Math.floor(e.y/16)-t.y;return{i:o,j:n,k:a,l:e.y-16*(n+t.y)}}},{key:"addCell",value:function(e,t){this.dataview[e]=t}},{key:"getDataIndex",value:function(e,t,o,a){return e*this.numchunks.y*256+256*t+16*o+a}}]),e}(),k=function(e){function t(e){var o;return Object(u.a)(this,t),(o=Object(c.a)(this,Object(r.a)(t).call(this,e))).state={tool_mode:f,debug_mode:!1,show_stats:!0,color_selected:1672153,update:{time:0,tot_time:0,num_updates:1},draw:{time:0,tot_time:0,num_updates:1},cursorx:0,cursory:0,offsetx:0,offsety:0,chunkx:0,chunky:0},o.getColorSelected=function(){return o.state.color_selected},o.getDebugMode=function(){return o.state.debug_mode},o.getToolMode=function(){return o.state.tool_mode},o.changeToolMode=function(e){o.setState({tool_mode:e})},o.changeColor=function(e){if("string"===typeof e){var t=parseInt(e.substring(1),16);console.log(e.substring(1)),console.log(t),o.setState({color_selected:t})}else"number"===typeof e&&o.setState({color_selected:e});o.changeToolMode(d)},o.isSelected=function(e){return"string"===typeof e?parseInt(e.substring(1),16)===o.state.color_selected:"number"===typeof e?e===o.state.color_selected:void 0},o.changeUpdateTime=function(e){o.setState({update:{time:e,tot_time:o.state.update.tot_time+e,num_updates:o.state.update.num_updates+1}})},o.changeDrawTime=function(e){o.setState({draw:{time:e,tot_time:o.state.draw.tot_time+e,num_updates:o.state.draw.num_updates+1}})},o.changeCursorLoc=function(e){o.setState({cursorx:e.x,cursory:e.y})},o.changeOffsetLoc=function(e){o.setState({offsetx:e.x,offsety:e.y})},o.changeChunkLoc=function(e,t){o.setState({chunkx:e,chunky:t})},o}return Object(l.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){document.body.style.overflow="hidden"}},{key:"render",value:function(){var e=this;return n.a.createElement("div",{className:"App-wrapper"},n.a.createElement(y,{toolmode:this.state.tool_mode,getToolMode:this.getToolMode,changeToolMode:this.changeToolMode,getDebugMode:this.getDebugMode,changeUpdateTime:this.changeUpdateTime,changeDrawTime:this.changeDrawTime,getColorSelected:this.getColorSelected,changeCursorLoc:this.changeCursorLoc,changeOffsetLoc:this.changeOffsetLoc,changeChunkLoc:this.changeChunkLoc,changeColor:this.changeColor}),n.a.createElement(w,{isSelected:this.isSelected,changeColor:this.changeColor}),n.a.createElement("div",{className:"drawer primary"},this.state.show_stats?n.a.createElement("div",{style:{position:"absolute",right:"0.8vw"}},"(",this.state.update.time,"ms, avg: ",Math.round(this.state.update.tot_time/this.state.update.num_updates),"ms, ",this.state.update.num_updates," updates)",n.a.createElement("br",null),"(",this.state.draw.time,"ms, avg: ",Math.round(this.state.draw.tot_time/this.state.draw.num_updates),"ms, ",this.state.draw.num_updates," draws)",n.a.createElement("br",null),"Cursor: (",this.state.cursorx,",",this.state.cursory,")",n.a.createElement("br",null),"Offset: (",this.state.offsetx,",",this.state.offsety,")",n.a.createElement("br",null),"Chunk: (",this.state.chunkx,",",this.state.chunky,")"):null,n.a.createElement("div",{className:"toolbutton"+(this.getToolMode()===d?"selected":"")+" blockbutton"+(this.getToolMode()===d?"selected":""),onClick:function(){e.changeToolMode(d)}},"draw"),n.a.createElement("div",{className:"toolbutton"+(1===this.getToolMode()?"selected":"")+" blockbutton"+(1===this.getToolMode()?"selected":""),onClick:function(){e.changeToolMode(1)}},"eyedrop"),n.a.createElement("div",{className:"toolbutton"+(this.getToolMode()===f?"selected":"")+" blockbutton"+(this.getToolMode()===f?"selected":""),onClick:function(){e.changeToolMode(f)}},"move"),n.a.createElement("input",{checked:this.state.debug_mode,type:"checkbox",onChange:function(){e.setState({debug_mode:!e.state.debug_mode})}})," Debug Mode\u2002",n.a.createElement("input",{checked:this.state.show_stats,type:"checkbox",onChange:function(){e.setState({show_stats:!e.state.show_stats})}})," Stats"))}}]),t}(n.a.Component),y=function(e){function t(e){var o;return Object(u.a)(this,t),(o=Object(c.a)(this,Object(r.a)(t).call(this,e))).drawLines=[],o.scale=16,o.tempscale=o.scale,o.cellpos={i:0,j:0,k:0,l:0},o.map_grid=null,o.canvasRef=Object(a.createRef)(),o.mapoffset=new v(0,0),o.celloffset=new v(0,0),o.currentcell=new v(0,0),o.startpoint=new v(0,0),o.cursorcurrent=new v(0,0),o.lmousedown=!1,o.rmousedown=!1,o.canvas=null,o}return Object(l.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){this.canvas=this.canvasRef.current,this.map_grid=new b,setTimeout(this.updateCanvas(),1e3)}},{key:"getCursorPosition",value:function(e,t){var o=t.getBoundingClientRect(),a=e.clientX-o.left,n=e.clientY-o.top;return new v(a,n)}},{key:"getCurrentCell",value:function(){var e=Math.floor((this.cursorcurrent.x-this.mapoffset.x*this.scale)/this.scale),t=Math.floor((this.cursorcurrent.y-this.mapoffset.y*this.scale)/this.scale);return new v(e,t)}},{key:"moveMap",value:function(e,t){var o=(t.x-e.x)/this.scale,a=(t.y-e.y)/this.scale;this.mapoffset.transform(o,a),this.celloffset.setTo(Math.floor(this.mapoffset.x),Math.floor(this.mapoffset.y)),this.props.changeOffsetLoc(this.celloffset)}},{key:"drawMap",value:function(e,t){var o=this,a=Date.now();this.resizeCanvas(e);var n,s,i,c=e.getBoundingClientRect(),r=c.width,l=c.height,u=e.getContext("2d");u.clearRect(0,0,r,l),u.fillStyle="#ffffff",u.fillRect(0,0,r,l);var h=Math.floor(this.mapoffset.x*this.scale),f=Math.floor(this.mapoffset.y*this.scale),m=function(e,a,n,c){s=(16*(e+t.x)+n)*o.scale+h,i=(16*(a+t.y)+c)*o.scale+f,s%1===0&&i%1===0&&o.scale%1===0||console.log("ALERT:",s,i,o.scale),u.fillRect(s,i,o.scale,o.scale)};if(null!==this.map_grid.data){var p=0;this.props.getDebugMode()&&u.beginPath();for(var g=0;g<this.map_grid.numchunks.x;g++)for(var v=0;v<this.map_grid.numchunks.y;v++){this.props.getDebugMode()&&(s=16*(g+t.x)*this.scale+h,i=16*(v+t.y)*this.scale+f,u.fillStyle="#000000",u.lineWidth=.01*Math.floor(this.scale),u.moveTo(s,0),u.lineTo(s,l),u.moveTo(0,i),u.lineTo(r,i));for(var b=0;b<256;b++){var k=Math.floor(b/16),y=b-16*k;16777215!==(n=this.map_grid.dataview[p+b])&&(u.fillStyle="#"+(16777215&n).toString(16).padStart(6,"0"),m(g,v,k,y))}p+=256}this.props.getDebugMode()&&u.stroke(),this.props.toolmode===d&&(u.fillStyle="#"+(16777215&this.props.getColorSelected()).toString(16).padStart(6,"0")+"ff",m(this.cellpos.i,this.cellpos.j,this.cellpos.k,this.cellpos.l)),this.props.changeDrawTime(Date.now()-a)}}},{key:"updateCanvas",value:function(){var e=this,t=Date.now(),o=this.map_grid.getValues(this.canvas,this.mapoffset.multipliedby(this.scale),this.scale),a=o.startpoint,n=o.numchunks,s=this.drawLines;this.drawLines=[],this.map_grid.setMatrix(n,a,s).then(function(){e.drawMap(e.canvas,a),e.startpoint=a,e.props.changeUpdateTime(Date.now()-t)}),setTimeout(function(){e.updateCanvas()},1e3)}},{key:"resizeCanvas",value:function(e){var t=e.getBoundingClientRect(),o=t.width,a=t.height;if(e.width!==o||e.height!==a){var n=window.devicePixelRatio,s=void 0===n?1:n,i=e.getContext("2d");return e.width=1*o*s,e.height=1*a*s,i.scale(s,s),!0}return!1}},{key:"drawCellAtMouse",value:function(e,t){var o=new v(e-this.celloffset.x,t-this.celloffset.y),a=this.map_grid.getChunkPosOffset(o,this.startpoint),n=a.i,s=a.j,i=a.k,c=a.l,r=this.map_grid.getDataIndex(n,s,i,c);r<this.map_grid.data.byteLength/4&&this.map_grid.addCell(r,this.props.getColorSelected())}},{key:"moveCursor",value:function(e){var t=!1,o=this.getCursorPosition(e,this.canvas);this.rmousedown&&(this.moveMap(this.cursorcurrent,o),t=!0),this.cursorcurrent=o;var a=this.getCurrentCell();return this.currentcell.isEqualTo(a)||(this.lmousedown&&this.drawLine(this.currentcell,a),this.currentcell=a,this.cellpos=this.map_grid.getChunkPosOffset(this.currentcell,this.startpoint),this.props.changeCursorLoc(this.currentcell),this.props.changeChunkLoc(this.cellpos.i+this.startpoint.x,this.cellpos.j+this.startpoint.y),t=!0),t}},{key:"drawLine",value:function(e,t){var o=this;!function(e,t,o,a){var n=e.x+o.x,s=e.y+o.y,i=t.x+o.x,c=t.y+o.y;n===i&&s===c&&a(n,s),Math.abs(c-s)<Math.abs(i-n)?n>i?p(i,c,n,s,a):p(n,s,i,c,a):s>c?g(i,c,n,s,a):g(n,s,i,c,a)}(e,t,this.celloffset,function(e,t){return o.drawCellAtMouse(e,t)}),this.drawLines.push({p1:e,p2:t,offset:this.celloffset,blockid:this.props.getColorSelected()})}},{key:"render",value:function(){var e=this;return n.a.createElement("canvas",{ref:this.canvasRef,className:"map-canvas primary",style:{cursor:function(){switch(e.props.toolmode){case 1:return"crosshair";case f:return"move";default:return"default"}}()},onContextMenu:function(e){e.preventDefault()},onMouseDown:function(t){if(t.preventDefault(),0===t.button)switch(e.props.toolmode){case 1:console.log("eyedroptool used");var o=e.map_grid.getChunkPosOffset(e.currentcell,e.startpoint),a=o.i,n=o.j,s=o.k,i=o.l,c=e.map_grid.getDataIndex(a,n,s,i);e.props.changeColor(e.map_grid.dataview[c]);break;case f:e.rmousedown=!0;break;default:e.lmousedown=!0,e.drawLine(e.currentcell,e.currentcell),e.drawMap(e.canvas,e.startpoint)}else 2===t.button&&(e.rmousedown=!0)},onMouseUp:function(t){e.lmousedown=!1,e.rmousedown=!1,e.drawMap(e.canvas,e.startpoint)},onMouseMove:function(t){e.moveCursor(t)&&e.drawMap(e.canvas,e.startpoint)},onMouseLeave:function(t){e.moveCursor(t),e.lmousedown=!1,e.rmousedown=!1,e.drawMap(e.canvas,e.startpoint)},onWheel:function(t){var o=e.tempscale-Math.floor(t.deltaY)/1e3;e.tempscale=o>3?o:3,e.scale=Math.floor(e.tempscale),e.drawMap(e.canvas,e.startpoint)}})}}]),t}(n.a.Component),w=function(e){function t(e){var o;return Object(u.a)(this,t),(o=Object(c.a)(this,Object(r.a)(t).call(this,e))).handleChange=function(e){o.props.changeColor(e.target.value)},o}return Object(l.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){var e=this;return n.a.createElement("div",{className:"palette primary"},m.map(function(t){return n.a.createElement("div",{key:t.blockid,style:{backgroundColor:"".concat(t.imagesrc)},className:"blockbutton"+(e.props.isSelected(t.imagesrc)?"selected":""),onClick:function(){e.props.changeColor(t.imagesrc)}})}),n.a.createElement("input",{type:"color",onChange:this.handleChange}))}}]),t}(n.a.Component);var C=function(){return n.a.createElement(k,null)},M=function(e){e&&e instanceof Function&&o.e(3).then(o.bind(null,20)).then(function(t){var o=t.getCLS,a=t.getFID,n=t.getFCP,s=t.getLCP,i=t.getTTFB;o(e),a(e),n(e),s(e),i(e)})};i.a.createRoot(document.getElementById("root")).render(n.a.createElement(n.a.StrictMode,null,n.a.createElement(C,null))),M()},8:function(e,t,o){e.exports=o(19)}},[[8,1,2]]]);
//# sourceMappingURL=main.d812245c.chunk.js.map