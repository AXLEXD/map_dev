(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{17:function(e,t,a){},18:function(e,t,a){},19:function(e,t,a){"use strict";a.r(t);var n=a(0),s=a.n(n),i=a(7),c=a.n(i),o=(a(17),a(4)),r=a(3),l=a(5),u=a(1),h=a(2),f=(a(18),16),d=[{blockid:"0",blockname:"1",imagesrc:"#ffffff"},{blockid:"1",blockname:"2",imagesrc:"#d1e7dc"},{blockid:"2",blockname:"3",imagesrc:"#c4d4e1"},{blockid:"3",blockname:"4",imagesrc:"#bcb5d3"},{blockid:"4",blockname:"5",imagesrc:"#f5dbe2"},{blockid:"5",blockname:"6",imagesrc:"#eeb6c9"},{blockid:"6",blockname:"7",imagesrc:"#c49abf"},{blockid:"7",blockname:"8",imagesrc:"#bada55"},{blockid:"8",blockname:"9",imagesrc:"#ffd700"},{blockid:"9",blockname:"10",imagesrc:"#f47b79"},{blockid:"a",blockname:"11",imagesrc:"#c6e2d4"},{blockid:"b",blockname:"12",imagesrc:"#b6d3c2"},{blockid:"c",blockname:"13",imagesrc:"#e0b1cb"},{blockid:"d",blockname:"14",imagesrc:"#d0a7b7"},{blockid:"e",blockname:"15",imagesrc:"#f3d1d3"},{blockid:"f",blockname:"16",imagesrc:"#e9b8c8"}];function m(e,t,a,n,s){var i=a-e,c=n-t,o=1;c<0&&(o=-1,c=-c);for(var r=2*c-i,l=t,u=e;u<a+1;u++)s(u,l),r>0?(l+=o,r+=2*(c-i)):r+=2*c}function g(e,t,a,n,s){var i=a-e,c=n-t,o=1;i<0&&(o=-1,i=-i);for(var r=2*i-c,l=e,u=t;u<n+1;u++)s(l,u),r>0?(l+=o,r+=2*(i-c)):r+=2*i}var p=function(){function e(t,a){Object(u.a)(this,e),this.x=t,this.y=a}return Object(h.a)(e,[{key:"transform",value:function(e,t){this.x+=e,this.y+=t}},{key:"setTo",value:function(e,t){this.x=e,this.y=t}},{key:"isEqualTo",value:function(e){return this.x===e.x&&this.y===e.y}},{key:"notEqualTo",value:function(e){return this.x!==e.x||this.y!==e.y}},{key:"positive",value:function(){return this.x>=0&&this.y>=0}},{key:"multipliedby",value:function(t){return new e(this.x*t,this.y*t)}},{key:"transformedby",value:function(t,a){return new e(this.x+t,this.y+a)}}]),e}(),v=function(){function e(t,a){Object(u.a)(this,e),this.canvasdimensions=new p(t,a),this.matrix=null,this.data=null,this.lastchunkrequesttime=null,this.numchunks=null}return Object(h.a)(e,[{key:"getValues",value:function(e,t){var a=f*t,n=new p(0,0),s=new p(0,0);return s.x=0===e.x?0:Math.floor(-1*e.x/a),s.y=0===e.y?0:Math.floor(-1*e.y/a),n.x=Math.ceil(this.canvasdimensions.x/a)+1,n.y=Math.ceil(this.canvasdimensions.y/a)+1,{startpoint:s,numchunks:n}}},{key:"setMatrix",value:function(e,t,a){for(var n=[],s=Array(e.x),i=0;i<e.x;i++){s[i]=Array(e.y);for(var c=0;c<e.y;c++){var o={x:t.x+i,y:t.y+c};n.push(o)}}var r=this;return new Promise(function(t,s){fetch("/getchunks",{method:"POST",headers:{Accept:"application/octet-stream","Content-Type":"application/json"},body:JSON.stringify({coords:n,lines:a})}).then(function(e){return e.arrayBuffer()}).then(function(a){r.data=a,r.numchunks=e,t()})})}},{key:"getChunkPosOffset",value:function(e,t){var a=Math.floor(e.x/f)-t.x,n=e.x-(a+t.x)*f,s=Math.floor(e.y/f)-t.y;return{cell_i:a,cell_j:s,cell_k:n,cell_l:e.y-(s+t.y)*f}}}]),e}(),k=function(e){function t(e){var a;return Object(u.a)(this,t),(a=Object(o.a)(this,Object(r.a)(t).call(this,e))).state={debug_mode:!1,show_stats:!0,block_selected:"ff0fff",update:{time:0,tot_time:0,num_updates:1},draw:{time:0,tot_time:0,num_updates:1},cursorx:0,cursory:0,offsetx:0,offsety:0,chunkx:0,chunky:0},a.changeBlock=function(e){a.setState({block_selected:e})},a.getBlockSelected=function(){return a.state.block_selected},a.getDebugMode=function(){return a.state.debug_mode},a.isSelected=function(e){return e===a.state.block_selected},a.changeUpdateTime=function(e){a.setState({update:{time:e,tot_time:a.state.update.tot_time+e,num_updates:a.state.update.num_updates+1}})},a.changeDrawTime=function(e){a.setState({draw:{time:e,tot_time:a.state.draw.tot_time+e,num_updates:a.state.draw.num_updates+1}})},a.changeCursorLoc=function(e){a.setState({cursorx:e.x,cursory:e.y})},a.changeOffsetLoc=function(e){a.setState({offsetx:e.x,offsety:e.y})},a.changeChunkLoc=function(e,t){a.setState({chunkx:e,chunky:t})},a}return Object(l.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){document.body.style.overflow="hidden"}},{key:"getData",value:function(){for(var e=new ArrayBuffer(1024),t=new Int32Array(e),a=0;a<t.length;a++)t[a]=2*a;fetch("/test",{method:"POST",headers:{Accept:"application/octet-stream","Content-Type":"application/octet-stream"},body:e}).then(function(e){return e.json()}).then(function(e){})}},{key:"render",value:function(){var e=this;return s.a.createElement("div",{className:"App-wrapper"},s.a.createElement(b,{getDebugMode:this.getDebugMode,changeUpdateTime:this.changeUpdateTime,changeDrawTime:this.changeDrawTime,getBlockSelected:this.getBlockSelected,changeCursorLoc:this.changeCursorLoc,changeOffsetLoc:this.changeOffsetLoc,changeChunkLoc:this.changeChunkLoc}),s.a.createElement(y,{isSelected:this.isSelected,changeBlock:this.changeBlock}),s.a.createElement("div",{className:"drawer primary"},this.state.show_stats?s.a.createElement("div",{style:{position:"absolute",right:"0.8vw"}},"(",this.state.update.time,"ms, avg: ",Math.round(this.state.update.tot_time/this.state.update.num_updates),"ms, ",this.state.update.num_updates," updates)",s.a.createElement("br",null),"(",this.state.draw.time,"ms, avg: ",Math.round(this.state.draw.tot_time/this.state.draw.num_updates),"ms, ",this.state.draw.num_updates," draws)",s.a.createElement("br",null),"Cursor: (",this.state.cursorx,",",this.state.cursory,")",s.a.createElement("br",null),"Offset: (",this.state.offsetx,",",this.state.offsety,")",s.a.createElement("br",null),"Chunk: (",this.state.chunkx,",",this.state.chunky,")"):null,s.a.createElement("b",null,"Instructions:"),s.a.createElement("br",null),"This is a pixel art canvas with infinite area. Scroll to zoom in and out, right click to pan around, and use left click to draw on the canvas.",s.a.createElement("br",null),"Use the palette on the right to select your colour.",s.a.createElement("div",{style:{color:"#909090"}},"(!!!!) Be aware that there is no saving yet lol, also this is just a prototype so limited colours, no drawing tools etc."),s.a.createElement("input",{type:"checkbox",onChange:function(){e.setState({debug_mode:!e.state.debug_mode})}})," Debug Mode\u2002",s.a.createElement("input",{checked:this.state.show_stats,type:"checkbox",onChange:function(){e.setState({show_stats:!e.state.show_stats})}})," Stats"))}}]),t}(s.a.Component),b=function(e){function t(e){var a;return Object(u.a)(this,t),(a=Object(o.a)(this,Object(r.a)(t).call(this,e))).getDebugMode=e.getDebugMode,a.getBlockSelected=e.getBlockSelected,a.changeUpdateTime=e.changeUpdateTime,a.changeDrawTime=e.changeDrawTime,a.changeCursorLoc=e.changeCursorLoc,a.changeOffsetLoc=e.changeOffsetLoc,a.changeChunkLoc=e.changeChunkLoc,a.drawLines=[],a.scale=16,a.map_grid=null,a.canvasRef=Object(n.createRef)(),a.mapoffset=new p(0,0),a.celloffset=new p(0,0),a.currentcell=new p(0,0),a.startpoint=new p(0,0),a.cursorcurrent=new p(0,0),a.lmousedown=!1,a.rmousedown=!1,a.canvas=null,a}return Object(l.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){this.canvas=this.canvasRef.current;var e=this.canvas.getBoundingClientRect(),t=e.width,a=e.height;this.map_grid=new v(t,a),setTimeout(this.updateCanvas(),1e3)}},{key:"getCursorPosition",value:function(e,t){var a=t.getBoundingClientRect(),n=e.clientX-a.left,s=e.clientY-a.top;return new p(n,s)}},{key:"getCurrentCell",value:function(){var e=Math.floor((this.cursorcurrent.x-this.mapoffset.x*this.scale)/this.scale),t=Math.floor((this.cursorcurrent.y-this.mapoffset.y*this.scale)/this.scale);return new p(e,t)}},{key:"moveMap",value:function(e,t){var a=(t.x-e.x)/this.scale,n=(t.y-e.y)/this.scale;this.mapoffset.transform(a,n),this.celloffset.setTo(Math.floor(this.mapoffset.x),Math.floor(this.mapoffset.y)),this.changeOffsetLoc(this.celloffset)}},{key:"drawMap",value:function(e,t){var a=this,n=Date.now();this.resizeCanvas(e);var s=e.getContext("2d");s.clearRect(0,0,e.width,e.height),s.fillStyle="#ffffff",s.fillRect(0,0,e.width,e.height);var i,c,o,r=this.map_grid.getChunkPosOffset(this.currentcell,t),l=r.cell_i,u=r.cell_j,h=r.cell_k,d=r.cell_l,m=function(e,n,i,r){c=((e+t.x)*f+i+a.mapoffset.x)*a.scale,o=((n+t.y)*f+r+a.mapoffset.y)*a.scale,s.fillRect(c,o,a.scale,a.scale)};if(null!==this.map_grid.data){var g=0,p=new Uint32Array(this.map_grid.data);this.getDebugMode()&&s.beginPath();for(var v=0;v<this.map_grid.numchunks.x;v++)for(var k=0;k<this.map_grid.numchunks.y;k++){this.getDebugMode()&&(c=((v+t.x)*f+this.mapoffset.x)*this.scale,o=((k+t.y)*f+this.mapoffset.y)*this.scale,s.fillStyle="#000000",s.lineWidth=.01*Math.floor(this.scale),s.moveTo(c,0),s.lineTo(c,this.canvas.height/2),s.moveTo(0,o),s.lineTo(this.canvas.width/2,o));for(var b=0;b<f*f;b++){var y=Math.floor(b/f),w=b-y*f;0!==(i=p[g+b])&&(s.fillStyle="#"+(16777215&i).toString(16).padStart(6,"0"),m(v,k,y,w))}g+=f*f}this.getDebugMode()&&s.stroke(),s.fillStyle="#"+this.getBlockSelected()+"8f",m(l,u,h,d),this.changeDrawTime(Date.now()-n)}}},{key:"updateCanvas",value:function(){var e=this,t=Date.now(),a=this.map_grid.getValues(this.mapoffset.multipliedby(this.scale),this.scale),n=a.startpoint,s=a.numchunks,i=this.drawLines;this.drawLines=[],this.map_grid.setMatrix(s,n,i).then(function(){e.drawMap(e.canvas,n),e.startpoint=n,e.changeUpdateTime(Date.now()-t)}),setTimeout(function(){e.updateCanvas()},1e3)}},{key:"resizeCanvas",value:function(e){var t=e.getBoundingClientRect(),a=t.width,n=t.height;if(e.width!==a||e.height!==n){var s=window.devicePixelRatio,i=void 0===s?1:s,c=e.getContext("2d");return e.width=a*i,e.height=n*i,c.scale(i,i),!0}return!1}},{key:"drawCellAtMouse",value:function(e,t){var a=new p(e-this.celloffset.x,t-this.celloffset.y),n=this.map_grid.getChunkPosOffset(a,this.startpoint),s=n.cell_i,i=n.cell_j,c=n.cell_k,o=n.cell_l;void 0!==this.map_grid.matrix[s][i]&&this.map_grid.matrix[s][i].addCell(c,o,parseInt(this.getBlockSelected(),16))}},{key:"moveCursor",value:function(e){var t=!1,a=this.getCursorPosition(e,this.canvas);this.rmousedown&&(this.moveMap(this.cursorcurrent,a),t=!0),this.cursorcurrent=a;var n=this.getCurrentCell();if(!this.currentcell.isEqualTo(n)){this.lmousedown&&this.drawLine(this.currentcell,n),this.currentcell=n,t=!0,this.changeCursorLoc(this.currentcell);var s=this.map_grid.getChunkPosOffset(this.currentcell,this.startpoint),i=s.cell_i,c=s.cell_j;s.cell_k,s.cell_l;this.changeChunkLoc(i+this.startpoint.x,c+this.startpoint.y)}return t}},{key:"drawLine",value:function(e,t){var a=this;!function(e,t,a,n){var s=e.x+a.x,i=e.y+a.y,c=t.x+a.x,o=t.y+a.y;s===c&&i===o&&n(s,i),Math.abs(o-i)<Math.abs(c-s)?s>c?m(c,o,s,i,n):m(s,i,c,o,n):i>o?g(c,o,s,i,n):g(s,i,c,o,n)}(e,t,this.celloffset,function(e,t){return a.drawCellAtMouse(e,t)}),this.drawLines.push({p1:e,p2:t,offset:this.celloffset,blockid:parseInt(this.getBlockSelected(),16)})}},{key:"render",value:function(){var e=this;return s.a.createElement("div",null,s.a.createElement("canvas",{ref:this.canvasRef,className:"map-canvas primary",onContextMenu:function(e){e.preventDefault()},onMouseDown:function(t){t.preventDefault(),0===t.button?(e.lmousedown=!0,e.drawLine(e.currentcell,e.currentcell),e.drawMap(e.canvas,e.startpoint)):2===t.button&&(e.rmousedown=!0)},onMouseUp:function(t){e.lmousedown=!1,e.rmousedown=!1,e.drawMap(e.canvas,e.startpoint)},onMouseMove:function(t){e.moveCursor(t)&&e.drawMap(e.canvas,e.startpoint)},onMouseLeave:function(t){e.moveCursor(t),e.lmousedown=!1,e.rmousedown=!1,e.drawMap(e.canvas,e.startpoint)},onWheel:function(t){t.preventDefault();var a=e.scale-Math.round(t.deltaY)/1e3;e.scale=a>.5?a:.5,e.drawMap(e.canvas,e.startpoint)}}))}}]),t}(s.a.Component),y=function(e){function t(e){var a;return Object(u.a)(this,t),(a=Object(o.a)(this,Object(r.a)(t).call(this,e))).changeBlock=e.changeBlock,a}return Object(l.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){var e=this;return s.a.createElement("div",{className:"palette primary"},d.map(function(t){return s.a.createElement("div",{key:t.blockid,style:{backgroundColor:"".concat(t.imagesrc)},className:"blockbutton"+(e.props.isSelected(t.blockid)?"selected":""),onClick:function(){e.changeBlock(t.blockid)}})}))}}]),t}(s.a.Component);var w=function(){return s.a.createElement(k,null)},x=function(e){e&&e instanceof Function&&a.e(3).then(a.bind(null,20)).then(function(t){var a=t.getCLS,n=t.getFID,s=t.getFCP,i=t.getLCP,c=t.getTTFB;a(e),n(e),s(e),i(e),c(e)})};c.a.createRoot(document.getElementById("root")).render(s.a.createElement(s.a.StrictMode,null,s.a.createElement(w,null))),x()},8:function(e,t,a){e.exports=a(19)}},[[8,1,2]]]);
//# sourceMappingURL=main.b04f3aed.chunk.js.map