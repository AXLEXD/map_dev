{"ast":null,"code":"import _possibleConstructorReturn from \"/Users/alex/Programming/web_development/map_dev_server/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/alex/Programming/web_development/map_dev_server/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/alex/Programming/web_development/map_dev_server/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _classCallCheck from \"/Users/alex/Programming/web_development/map_dev_server/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/alex/Programming/web_development/map_dev_server/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nvar _jsxFileName = \"/Users/alex/Programming/web_development/map_dev_server/client/src/App.js\";\nimport './App.css';\nimport React, { createRef } from 'react';\nimport { createImageData } from 'canvas';\nvar CHUNKSIZE = 16;\nvar LOWESTSCALE = 3;\nvar DRAWTOOL = 0;\nvar EYEDROPTOOL = 1;\nvar MOVETOOL = 2;\n\n// const blocks = [\n//     {\n//         blockid: '0',\n//         blockname: '1',\n//         imagesrc: '#ffffff'\n//     },\n//     {\n//         blockid: '1',\n//         blockname: '2',\n//         imagesrc: '#d1e7dc'\n//     },\n//     {\n//         blockid: '2',\n//         blockname: '3',\n//         imagesrc: '#c4d4e1'\n//     },\n//     {\n//         blockid: '3',\n//         blockname: '4',\n//         imagesrc: '#bcb5d3'\n//     },\n//     {\n//         blockid: '4',\n//         blockname: '5',\n//         imagesrc: '#f5dbe2'\n//     },\n//     {\n//         blockid: '5',\n//         blockname: '6',\n//         imagesrc: '#eeb6c9'\n//     },\n//     {\n//         blockid: '6',\n//         blockname: '7',\n//         imagesrc: '#c49abf'\n//     },\n//     {\n//         blockid: '7',\n//         blockname: '8',\n//         imagesrc: '#bada55'\n//     },\n//     {\n//         blockid: '8',\n//         blockname: '9',\n//         imagesrc: '#ffd700'\n//     },\n//     {\n//         blockid: '9',\n//         blockname: '10',\n//         imagesrc: '#f47b79'\n//     },\n//     {\n//         blockid: 'a',\n//         blockname: '11',\n//         imagesrc: '#c6e2d4'\n//     },\n//     {\n//         blockid: 'b',\n//         blockname: '12',\n//         imagesrc: '#b6d3c2'\n//     },\n//     {\n//         blockid: 'c',\n//         blockname: '13',\n//         imagesrc: '#e0b1cb'\n//     },\n//     {\n//         blockid: 'd',\n//         blockname: '14',\n//         imagesrc: '#d0a7b7'\n//     },\n//     {\n//         blockid: 'e',\n//         blockname: '15',\n//         imagesrc: '#f3d1d3'\n//     },\n//     {\n//         blockid: 'f',\n//         blockname: '16',\n//         imagesrc: '#e9b8c8'\n//     }\n// ];\n\nvar colors = [\"#000000\",\n// Black\n\"#FFFFFF\",\n// White\n\"#FF0000\",\n// Red\n\"#00FF00\",\n// Green\n\"#0000FF\",\n// Blue\n\"#FFFF00\",\n// Yellow\n\"#FF00FF\",\n// Magenta\n\"#00FFFF\",\n// Cyan\n\"#800000\",\n// Maroon\n\"#008000\",\n// Olive\n\"#000080\",\n// Navy\n\"#808000\",\n// Olive Drab\n\"#800080\",\n// Purple\n\"#008080\",\n// Teal\n\"#808080\",\n// Gray\n\"#C0C0C0\",\n// Silver\n\"#FFC0CB\",\n// Pink\n\"#FFA07A\",\n// Light Salmon\n\"#FF7F50\",\n// Coral\n\"#FF6347\",\n// Tomato\n\"#FF4500\",\n// Orange Red\n\"#FF8C00\",\n// Dark Orange\n\"#FFD700\",\n// Gold\n\"#FFFFE0\",\n// Light Yellow\n\"#EEE8AA\",\n// Pale Goldenrod\n\"#ADFF2F\",\n// Green Yellow\n\"#32CD32\",\n// Lime Green\n\"#00FA9A\",\n// Medium Spring Green\n\"#00CED1\",\n// Dark Turquoise\n\"#6A5ACD\",\n// Slate Blue\n\"#7B68EE\",\n// Medium Slate Blue\n\"#FF69B4\",\n// Hot Pink\n\"#8B4513\" // Saddle Brown\n];\n\nfunction plotLineLow(x0, y0, x1, y1, drawFunc) {\n  var dx = x1 - x0;\n  var dy = y1 - y0;\n  var yi = 1;\n  if (dy < 0) {\n    yi = -1;\n    dy = -dy;\n  }\n  var D = 2 * dy - dx;\n  var y = y0;\n  for (var x = x0; x < x1 + 1; x++) {\n    drawFunc(x, y);\n    if (D > 0) {\n      y = y + yi;\n      D = D + 2 * (dy - dx);\n    } else {\n      D = D + 2 * dy;\n    }\n  }\n}\nfunction plotLineHigh(x0, y0, x1, y1, drawFunc) {\n  var dx = x1 - x0;\n  var dy = y1 - y0;\n  var xi = 1;\n  if (dx < 0) {\n    xi = -1;\n    dx = -dx;\n  }\n  var D = 2 * dx - dy;\n  var x = x0;\n  for (var y = y0; y < y1 + 1; y++) {\n    drawFunc(x, y);\n    if (D > 0) {\n      x = x + xi;\n      D = D + 2 * (dx - dy);\n    } else {\n      D = D + 2 * dx;\n    }\n  }\n}\nfunction plotLine(p1, p2, offset, drawFunc) {\n  var x0 = p1.x + offset.x;\n  var y0 = p1.y + offset.y;\n  var x1 = p2.x + offset.x;\n  var y1 = p2.y + offset.y;\n  if (x0 === x1 && y0 === y1) drawFunc(x0, y0);\n  if (Math.abs(y1 - y0) < Math.abs(x1 - x0)) {\n    if (x0 > x1) plotLineLow(x1, y1, x0, y0, drawFunc);else plotLineLow(x0, y0, x1, y1, drawFunc);\n  } else {\n    if (y0 > y1) plotLineHigh(x1, y1, x0, y0, drawFunc);else plotLineHigh(x0, y0, x1, y1, drawFunc);\n  }\n}\nfunction colorTo32Uint(colorstring) {\n  return parseInt(colorstring.substring(1), 16);\n}\nfunction colorToString(colornum) {\n  return \"#\" + (colornum & 0x00FFFFFF).toString(16).padStart(6, '0');\n}\nvar Vector2D = /*#__PURE__*/function () {\n  function Vector2D(x, y) {\n    _classCallCheck(this, Vector2D);\n    this.x = x;\n    this.y = y;\n  }\n  _createClass(Vector2D, [{\n    key: \"transform\",\n    value: function transform(x, y) {\n      this.x += x;\n      this.y += y;\n    }\n  }, {\n    key: \"setTo\",\n    value: function setTo(x, y) {\n      this.x = x;\n      this.y = y;\n    }\n  }, {\n    key: \"isEqualTo\",\n    value: function isEqualTo(othervector) {\n      return this.x === othervector.x && this.y === othervector.y;\n    }\n  }, {\n    key: \"notEqualTo\",\n    value: function notEqualTo(othervector) {\n      return this.x !== othervector.x || this.y !== othervector.y;\n    }\n  }, {\n    key: \"positive\",\n    value: function positive() {\n      return this.x >= 0 && this.y >= 0;\n    }\n  }, {\n    key: \"multipliedby\",\n    value: function multipliedby(number) {\n      return new Vector2D(this.x * number, this.y * number);\n    }\n  }, {\n    key: \"transformedby\",\n    value: function transformedby(x, y) {\n      return new Vector2D(this.x + x, this.y + y);\n    }\n  }]);\n  return Vector2D;\n}();\nvar Map = /*#__PURE__*/function () {\n  function Map() {\n    _classCallCheck(this, Map);\n    // this.canvasdimensions = new Vector2D(w,h); // establishing at start means no resizing canvas element\n    this.data = null;\n    this.dataview = null;\n    this.numchunks = null;\n  }\n  _createClass(Map, [{\n    key: \"getValues\",\n    value: function getValues(canvas, offset, scale) {\n      var chunkpixels = CHUNKSIZE * scale;\n      var numchunks = new Vector2D(0, 0);\n      var startpoint = new Vector2D(0, 0);\n      startpoint.x = offset.x === 0 ? 0 : Math.floor(-1 * offset.x / chunkpixels);\n      startpoint.y = offset.y === 0 ? 0 : Math.floor(-1 * offset.y / chunkpixels);\n      var _canvas$getBoundingCl = canvas.getBoundingClientRect(),\n        width = _canvas$getBoundingCl.width,\n        height = _canvas$getBoundingCl.height;\n      numchunks.x = Math.ceil(width / chunkpixels) + 1; // bit cheaty - should probs optimise\n      numchunks.y = Math.ceil(height / chunkpixels) + 1;\n      return {\n        startpoint: startpoint,\n        numchunks: numchunks\n      };\n    }\n  }, {\n    key: \"setMatrix\",\n    value: function setMatrix(dimn, start, lines) {\n      var coords = [];\n      var map_grid = this;\n      for (var i = 0; i < dimn.x; i++) {\n        for (var j = 0; j < dimn.y; j++) {\n          var coordsobj = {\n            x: start.x + i,\n            y: start.y + j\n          };\n          coords.push(coordsobj);\n        }\n      }\n      return new Promise(function (resolve, reject) {\n        fetch('/getchunks', {\n          method: 'POST',\n          headers: {\n            'Accept': 'application/octet-stream',\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify({\n            coords: coords,\n            lines: lines\n          })\n        }).then(function (data) {\n          return data.arrayBuffer();\n        }).then(function (chunkbuffer) {\n          // console.log([...new Uint8Array(chunkbuffer)].map(x => x.toString(16).padStart(2, '0')));\n          // map_grid.data = chunkbuffer;\n          // map_grid.dataview = new Uint32Array(map_grid.data);\n          map_grid.numchunks = dimn;\n          var cellsize = 5;\n          map_grid.data = new ArrayBuffer(chunkbuffer.byteLength * cellsize * cellsize);\n          map_grid.dataview = new Uint32Array(map_grid.data).fill(4294967295);\n          var Uint32data = new Uint32Array(chunkbuffer);\n          // console.log(new Uint8Array(chunkbuffer));\n\n          // for (let i=0;i<map_grid.numchunks.x;i++) {\n          //     for (let j=0;j<map_grid.numchunks.y;j++) {\n          //         for (let k=0;k<CHUNKSIZE;k++) {\n          //             for (let l=0;l<CHUNKSIZE;l++) {\n          //                 let bmp_index = i*CHUNKSIZE+j*map_grid.numchunks.x*(CHUNKSIZE*CHUNKSIZE)+k+l* map_grid.numchunks.x*CHUNKSIZE;\n          //                 let alex_index = map_grid.getDataIndex(i,j,k,l);\n          //                 map_grid.dataview[bmp_index] = Uint32data[alex_index];\n          //             }\n          //         }\n          //     }\n          // }\n          for (var _i = 0; _i < map_grid.numchunks.x; _i++) {\n            for (var _j = 0; _j < map_grid.numchunks.y; _j++) {\n              for (var k = 0; k < CHUNKSIZE; k++) {\n                for (var l = 0; l < CHUNKSIZE; l++) {\n                  var bmp_index = _i * CHUNKSIZE + _j * map_grid.numchunks.x * (CHUNKSIZE * CHUNKSIZE) * cellsize + k + l * map_grid.numchunks.x * CHUNKSIZE * cellsize;\n                  var alex_index = map_grid.getDataIndex(_i, _j, k, l);\n                  // map_grid.dataview[bmp_index] = Uint32data[alex_index];\n                  // bmp_index*=cellsize;\n                  for (var a = 0; a < cellsize; a++) {\n                    for (var b = 0; b < cellsize; b++) {\n                      // if (a===1&&b===0) bmp_index+=2;\n                      // bmp_index+=a;\n                      // if (a==0&&b==0) bmp_index+=a+b*map_grid.numchunks.x*CHUNKSIZE*cellsize;\n                      // bmp_index += a + b*map_grid.numchunks.x*cellsize*cellsize;\n                      // let bmp_index = i*CHUNKSIZE*cellsize+j*map_grid.numchunks.x*(CHUNKSIZE*CHUNKSIZE)*cellsize*cellsize+(k*cellsize+a)+(l*cellsize*cellsize+b)*map_grid.numchunks.x*CHUNKSIZE;\n                      map_grid.dataview[bmp_index] = Uint32data[alex_index];\n                    }\n                  }\n                }\n              }\n            }\n          }\n          resolve();\n        });\n      });\n    }\n  }, {\n    key: \"getChunkPosOffset\",\n    value: function getChunkPosOffset(currentcell, startpoint) {\n      var i = Math.floor(currentcell.x / CHUNKSIZE) - startpoint.x;\n      var k = currentcell.x - (i + startpoint.x) * CHUNKSIZE;\n      var j = Math.floor(currentcell.y / CHUNKSIZE) - startpoint.y;\n      var l = currentcell.y - (j + startpoint.y) * CHUNKSIZE;\n      return {\n        i: i,\n        j: j,\n        k: k,\n        l: l\n      };\n    }\n  }, {\n    key: \"addCell\",\n    value: function addCell(index, colorhex) {\n      this.dataview[index] = colorhex;\n      // console.log(data[index], colorhex);\n    }\n  }, {\n    key: \"getDataIndex\",\n    value: function getDataIndex(i, j, k, l) {\n      return i * this.numchunks.y * (CHUNKSIZE * CHUNKSIZE) + j * (CHUNKSIZE * CHUNKSIZE) + k * CHUNKSIZE + l;\n    }\n  }]);\n  return Map;\n}();\nvar AppWrapper = /*#__PURE__*/function (_React$Component) {\n  _inherits(AppWrapper, _React$Component);\n  function AppWrapper(props) {\n    var _this;\n    _classCallCheck(this, AppWrapper);\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(AppWrapper).call(this, props));\n    _this.state = {\n      tool_mode: MOVETOOL,\n      debug_mode: false,\n      show_stats: true,\n      color_selected: 1672153,\n      update: {\n        time: 0,\n        tot_time: 0,\n        num_updates: 1\n      },\n      draw: {\n        time: 0,\n        tot_time: 0,\n        num_updates: 1\n      },\n      cursorx: 0,\n      cursory: 0,\n      offsetx: 0,\n      offsety: 0,\n      chunkx: 0,\n      chunky: 0,\n      cxstart: 0,\n      cystart: 0,\n      cxend: 0,\n      cyend: 0\n    };\n    _this.getColorSelected = function () {\n      return _this.state.color_selected;\n    };\n    _this.getDebugMode = function () {\n      return _this.state.debug_mode;\n    };\n    _this.getToolMode = function () {\n      return _this.state.tool_mode;\n    };\n    _this.changeToolMode = function (change_to) {\n      _this.setState({\n        tool_mode: change_to\n      });\n    };\n    _this.changeColor = function (color) {\n      if (typeof color === 'string') {\n        var out_num = colorTo32Uint(color);\n        _this.setState({\n          color_selected: out_num\n        });\n      } else if (typeof color === 'number') {\n        _this.setState({\n          color_selected: color\n        });\n      }\n      _this.changeToolMode(DRAWTOOL);\n    };\n    _this.isSelected = function (color) {\n      if (typeof color === 'string') {\n        var out_num = colorTo32Uint(color);\n        return out_num === _this.state.color_selected;\n      } else if (typeof color === 'number') {\n        return color === _this.state.color_selected;\n      }\n    };\n    _this.changeUpdateTime = function (new_time) {\n      _this.setState({\n        update: {\n          time: new_time,\n          tot_time: _this.state.update.tot_time + new_time,\n          num_updates: _this.state.update.num_updates + 1\n        }\n      });\n    };\n    _this.changeDrawTime = function (new_time) {\n      _this.setState({\n        draw: {\n          time: new_time,\n          tot_time: _this.state.draw.tot_time + new_time,\n          num_updates: _this.state.draw.num_updates + 1\n        }\n      });\n    };\n    _this.changeCursorLoc = function (vector) {\n      _this.setState({\n        cursorx: vector.x,\n        cursory: vector.y\n      });\n    };\n    _this.changeOffsetLoc = function (vector) {\n      _this.setState({\n        offsetx: vector.x,\n        offsety: vector.y\n      });\n    };\n    _this.changeChunkLoc = function (x, y) {\n      _this.setState({\n        chunkx: x,\n        chunky: y\n      });\n    };\n    return _this;\n  }\n  _createClass(AppWrapper, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      document.body.style.overflow = \"hidden\"; // stops user from scrolling the page\n    }\n  }, {\n    key: \"mapDownload\",\n    value: function mapDownload() {\n      var filename;\n      var coordsobj = {\n        x1: this.state.cxstart,\n        y1: this.state.cystart,\n        x2: this.state.cxend,\n        y2: this.state.cyend\n      };\n      if (coordsobj.x1 === coordsobj.x2 || coordsobj.y1 === coordsobj.y2 || coordsobj.x1 > coordsobj.x2 || coordsobj.y1 > coordsobj.y2) return;\n      fetch('/getimage', {\n        method: 'POST',\n        headers: {\n          'Accept': 'application/octet-stream',\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(coordsobj)\n      }).then(function (response) {\n        filename = response.headers.get('Content-Disposition').split('\"')[1];\n        return response.blob();\n      }).then(function (pngblob) {\n        var url = window.URL.createObjectURL(pngblob);\n        var link = document.createElement('a');\n        link.href = url;\n        link.setAttribute('download', filename);\n        document.body.appendChild(link);\n        link.click();\n        link.parentNode.removeChild(link);\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"App-wrapper\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 478,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(MapCanvas, {\n        toolmode: this.state.tool_mode,\n        getToolMode: this.getToolMode,\n        changeToolMode: this.changeToolMode,\n        getDebugMode: this.getDebugMode,\n        changeUpdateTime: this.changeUpdateTime,\n        changeDrawTime: this.changeDrawTime,\n        getColorSelected: this.getColorSelected,\n        changeCursorLoc: this.changeCursorLoc,\n        changeOffsetLoc: this.changeOffsetLoc,\n        changeChunkLoc: this.changeChunkLoc,\n        changeColor: this.changeColor,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 479,\n          columnNumber: 17\n        }\n      }), /*#__PURE__*/React.createElement(Palette, {\n        isSelected: this.isSelected,\n        changeColor: this.changeColor,\n        color: this.state.color_selected,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 492,\n          columnNumber: 17\n        }\n      }), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"drawer primary\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 493,\n          columnNumber: 17\n        }\n      }, this.state.show_stats ? /*#__PURE__*/React.createElement(\"div\", {\n        style: {\n          position: \"absolute\",\n          right: \"0.8vw\"\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 494,\n          columnNumber: 47\n        }\n      }, \"(\", this.state.update.time, \"ms, avg: \", Math.round(this.state.update.tot_time / this.state.update.num_updates), \"ms, \", this.state.update.num_updates, \" updates)\", /*#__PURE__*/React.createElement(\"br\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 496,\n          columnNumber: 25\n        }\n      }), \"(\", this.state.draw.time, \"ms, avg: \", Math.round(this.state.draw.tot_time / this.state.draw.num_updates), \"ms, \", this.state.draw.num_updates, \" draws)\", /*#__PURE__*/React.createElement(\"br\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 497,\n          columnNumber: 25\n        }\n      }), \"Cursor: (\", this.state.cursorx, \",\", this.state.cursory, \")\", /*#__PURE__*/React.createElement(\"br\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 498,\n          columnNumber: 25\n        }\n      }), \"Offset: (\", this.state.offsetx, \",\", this.state.offsety, \")\", /*#__PURE__*/React.createElement(\"br\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 499,\n          columnNumber: 25\n        }\n      }), \"Chunk: (\", this.state.chunkx, \",\", this.state.chunky, \")\") : null, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"toolbutton\" + (this.getToolMode() === DRAWTOOL ? \"selected\" : \"\") + \" blockbutton\" + (this.getToolMode() === DRAWTOOL ? \"selected\" : \"\"),\n        onClick: function onClick() {\n          _this2.changeToolMode(DRAWTOOL);\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 502,\n          columnNumber: 21\n        }\n      }, \"draw\"), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"toolbutton\" + (this.getToolMode() === EYEDROPTOOL ? \"selected\" : \"\") + \" blockbutton\" + (this.getToolMode() === EYEDROPTOOL ? \"selected\" : \"\"),\n        onClick: function onClick() {\n          _this2.changeToolMode(EYEDROPTOOL);\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 506,\n          columnNumber: 21\n        }\n      }, \"eyedrop\"), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"toolbutton\" + (this.getToolMode() === MOVETOOL ? \"selected\" : \"\") + \" blockbutton\" + (this.getToolMode() === MOVETOOL ? \"selected\" : \"\"),\n        onClick: function onClick() {\n          _this2.changeToolMode(MOVETOOL);\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 510,\n          columnNumber: 21\n        }\n      }, \"move\"), /*#__PURE__*/React.createElement(\"input\", {\n        checked: this.state.debug_mode,\n        type: \"checkbox\",\n        onChange: function onChange() {\n          _this2.setState({\n            debug_mode: !_this2.state.debug_mode\n          });\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 516,\n          columnNumber: 21\n        }\n      }), \" Debug Mode\\u2002\", /*#__PURE__*/React.createElement(\"input\", {\n        checked: this.state.show_stats,\n        type: \"checkbox\",\n        onChange: function onChange() {\n          _this2.setState({\n            show_stats: !_this2.state.show_stats\n          });\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 517,\n          columnNumber: 21\n        }\n      }), \" Stats\", /*#__PURE__*/React.createElement(\"table\", {\n        className: \"download-wrapper\"\n        // onClick={() => this.fileDownload()}\n        ,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 518,\n          columnNumber: 21\n        }\n      }, /*#__PURE__*/React.createElement(\"tbody\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 521,\n          columnNumber: 22\n        }\n      }, /*#__PURE__*/React.createElement(\"tr\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 522,\n          columnNumber: 25\n        }\n      }, /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 523,\n          columnNumber: 29\n        }\n      }, /*#__PURE__*/React.createElement(\"p\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 524,\n          columnNumber: 33\n        }\n      }, \"from:\\xA0\"), /*#__PURE__*/React.createElement(\"input\", {\n        defaultValue: \"0\",\n        type: \"number\",\n        style: {\n          width: \"35px\"\n        },\n        onChange: function onChange(e) {\n          return _this2.setState({\n            cxstart: parseInt(e.target.value)\n          });\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 524,\n          columnNumber: 51\n        }\n      }), /*#__PURE__*/React.createElement(\"input\", {\n        defaultValue: \"0\",\n        type: \"number\",\n        style: {\n          width: \"35px\"\n        },\n        onChange: function onChange(e) {\n          return _this2.setState({\n            cystart: parseInt(e.target.value)\n          });\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 525,\n          columnNumber: 33\n        }\n      }))), /*#__PURE__*/React.createElement(\"tr\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 528,\n          columnNumber: 25\n        }\n      }, /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 529,\n          columnNumber: 29\n        }\n      }, /*#__PURE__*/React.createElement(\"p\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 530,\n          columnNumber: 33\n        }\n      }, \"to:\\xA0\"), /*#__PURE__*/React.createElement(\"input\", {\n        defaultValue: \"0\",\n        type: \"number\",\n        style: {\n          width: \"35px\"\n        },\n        onChange: function onChange(e) {\n          return _this2.setState({\n            cxend: parseInt(e.target.value)\n          });\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 530,\n          columnNumber: 49\n        }\n      }), /*#__PURE__*/React.createElement(\"input\", {\n        defaultValue: \"0\",\n        type: \"number\",\n        style: {\n          width: \"35px\"\n        },\n        onChange: function onChange(e) {\n          return _this2.setState({\n            cyend: parseInt(e.target.value)\n          });\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 531,\n          columnNumber: 33\n        }\n      }))), /*#__PURE__*/React.createElement(\"tr\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 534,\n          columnNumber: 25\n        }\n      }, /*#__PURE__*/React.createElement(\"td\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 535,\n          columnNumber: 29\n        }\n      }, /*#__PURE__*/React.createElement(\"p\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 536,\n          columnNumber: 33\n        }\n      }, \"Save PNG:\"), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"download-button\",\n        onClick: function onClick() {\n          return _this2.mapDownload();\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 537,\n          columnNumber: 33\n        }\n      }, /*#__PURE__*/React.createElement(\"img\", {\n        src: \"save.png\",\n        alt: \"save\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 537,\n          columnNumber: 103\n        }\n      }))))))));\n    }\n  }]);\n  return AppWrapper;\n}(React.Component);\nvar MapCanvas = /*#__PURE__*/function (_React$Component2) {\n  _inherits(MapCanvas, _React$Component2);\n  function MapCanvas(props) {\n    var _this3;\n    _classCallCheck(this, MapCanvas);\n    _this3 = _possibleConstructorReturn(this, _getPrototypeOf(MapCanvas).call(this, props));\n    _this3.drawLines = [];\n    _this3.lastdraw = 0;\n    _this3.scale = 16;\n    _this3.tempscale = _this3.scale;\n    _this3.cellpos = {\n      i: 0,\n      j: 0,\n      k: 0,\n      l: 0\n    };\n    _this3.map_grid = null;\n    _this3.canvasRef = createRef();\n    _this3.canvasRef2 = createRef();\n    _this3.mapoffset = new Vector2D(0, 0);\n    _this3.celloffset = new Vector2D(0, 0);\n    _this3.currentcell = new Vector2D(0, 0);\n    _this3.startpoint = new Vector2D(0, 0);\n    _this3.cursorcurrent = new Vector2D(0, 0);\n    _this3.lmousedown = false;\n    _this3.rmousedown = false;\n    _this3.canvas = null;\n    _this3.is_updating = false;\n    _this3.drawcache = [];\n    return _this3;\n  }\n\n  //Called after element's initialisation\n  _createClass(MapCanvas, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this4 = this;\n      this.canvas = this.canvasRef.current;\n      this.map_grid = new Map();\n      this.resizeCanvas(this.canvas);\n      window.addEventListener('resize', function () {\n        return _this4.resizeCanvas(_this4.canvas);\n      });\n      setTimeout(this.updateCanvas(), 1000);\n    }\n  }, {\n    key: \"getCursorPosition\",\n    value: function getCursorPosition(event, canvas) {\n      var rect = canvas.getBoundingClientRect();\n      var x = event.clientX - rect.left;\n      var y = event.clientY - rect.top;\n      var pos = new Vector2D(x, y);\n      return pos;\n    }\n  }, {\n    key: \"getCurrentCell\",\n    value: function getCurrentCell() {\n      var x = Math.floor((this.cursorcurrent.x - this.mapoffset.x * this.scale) / this.scale);\n      var y = Math.floor((this.cursorcurrent.y - this.mapoffset.y * this.scale) / this.scale);\n      var pos = new Vector2D(x, y);\n      return pos;\n    }\n  }, {\n    key: \"moveMap\",\n    value: function moveMap(start, end) {\n      var x = (end.x - start.x) / this.scale;\n      var y = (end.y - start.y) / this.scale;\n      this.mapoffset.transform(x, y);\n      this.celloffset.setTo(Math.floor(this.mapoffset.x), Math.floor(this.mapoffset.y));\n      this.props.changeOffsetLoc(this.celloffset);\n    }\n  }, {\n    key: \"drawMap\",\n    value: function drawMap(canvas, startpoint, isupdate) {\n      var _this5 = this;\n      if (this.map_grid.data === null || this.map_grid.numchunks === null) return;\n\n      // let blob = new Blob([this.map_grid.data]);\n      // console.log(blob);\n\n      var newCanvas = this.canvasRef2.current;\n      newCanvas.width = 400;\n      newCanvas.height = 400;\n      // console.log(newCanvas.width, newCanvas.height);\n\n      var imageData = new ImageData(new Uint8ClampedArray(this.map_grid.data), this.map_grid.numchunks.x * CHUNKSIZE * 5);\n      // let imageData = createImageData(new Uint8ClampedArray(this.map_grid.data), this.map_grid.numchunks.x*CHUNKSIZE*CHUNKSIZE);\n      console.log(imageData);\n      console.log(imageData.data.slice(6400 * 4 - 1));\n      var bctx = canvas.getContext(\"2d\");\n      // bctx.transferFromImageData(bitmap);\n      newCanvas.getContext(\"2d\").putImageData(imageData, 0, 0);\n      // bctx.scale(1.1,1.1);\n      bctx.drawImage(newCanvas, 0, 0);\n      return;\n      var start = Date.now();\n\n      // if (start < (this.lastdraw + 1000/60)) return; // Only drawing every 1/60th of a second\n      this.lastdraw = start;\n      var _canvas$getBoundingCl2 = canvas.getBoundingClientRect(),\n        width = _canvas$getBoundingCl2.width,\n        height = _canvas$getBoundingCl2.height;\n      var ctx = canvas.getContext(\"2d\", {\n        alpha: false\n      });\n      ctx.clearRect(0, 0, width, height);\n      ctx.fillStyle = \"#ffffff\";\n      ctx.fillRect(0, 0, width, height);\n\n      // finding location in terms of iterators of current cell\n      // let {cell_i, cell_j, cell_k, cell_l} = this.map_grid.getChunkPosOffset(this.currentcell, startpoint);\n\n      var colornum;\n      var x;\n      var y;\n      var mapoffset_x = Math.floor(this.mapoffset.x * this.scale);\n      var mapoffset_y = Math.floor(this.mapoffset.y * this.scale);\n      // let mapoffset_x = this.mapoffset.x;\n      // let mapoffset_y = this.mapoffset.y;\n\n      var doFill = function doFill(i, j, k, l) {\n        x = ((i + startpoint.x) * CHUNKSIZE + k) * _this5.scale + mapoffset_x;\n        y = ((j + startpoint.y) * CHUNKSIZE + l) * _this5.scale + mapoffset_y;\n        if (x % 1 !== 0 || y % 1 !== 0 || _this5.scale % 1 !== 0) console.log(\"ALERT:\", x, y, _this5.scale);\n        ctx.fillRect(x, y, _this5.scale, _this5.scale);\n        // console.log(x,y,cellapparentsize);\n      };\n\n      if (this.map_grid.data === null) return;\n      // for map\n\n      var chunkbufferoffset = 0;\n      if (this.props.getDebugMode()) ctx.beginPath();\n      for (var i = 0; i < this.map_grid.numchunks.x; i++) {\n        for (var j = 0; j < this.map_grid.numchunks.y; j++) {\n          // for each chunk\n          if (this.props.getDebugMode()) {\n            x = (i + startpoint.x) * CHUNKSIZE * this.scale + mapoffset_x;\n            y = (j + startpoint.y) * CHUNKSIZE * this.scale + mapoffset_y;\n            ctx.fillStyle = \"#000000\";\n            ctx.lineWidth = 0.01 * Math.floor(this.scale);\n            ctx.moveTo(x, 0);\n            ctx.lineTo(x, height);\n            // ctx.stroke();\n            ctx.moveTo(0, y);\n            ctx.lineTo(width, y);\n          }\n          for (var c = 0; c < CHUNKSIZE * CHUNKSIZE; c++) {\n            var k = Math.floor(c / CHUNKSIZE);\n            var l = c - k * CHUNKSIZE;\n            colornum = this.map_grid.dataview[chunkbufferoffset + c];\n            if (colornum !== 16777215) {\n              ctx.fillStyle = colorToString(colornum);\n              doFill(i, j, k, l);\n            }\n          }\n          chunkbufferoffset += CHUNKSIZE * CHUNKSIZE;\n        }\n      }\n      if (this.props.getDebugMode()) ctx.stroke();\n      if (this.props.toolmode === DRAWTOOL) {\n        ctx.fillStyle = colorToString(this.props.getColorSelected()) + \"ff\";\n        doFill(this.cellpos.i, this.cellpos.j, this.cellpos.k, this.cellpos.l);\n      }\n      this.props.changeDrawTime(Date.now() - start);\n    }\n  }, {\n    key: \"updateCanvas\",\n    value: function updateCanvas() {\n      var _this6 = this;\n      var start = Date.now(); // time testing\n      var _this$map_grid$getVal = this.map_grid.getValues(this.canvas, this.mapoffset.multipliedby(this.scale), this.scale),\n        startpoint = _this$map_grid$getVal.startpoint,\n        numchunks = _this$map_grid$getVal.numchunks;\n      var linestosend = this.drawLines;\n      this.drawLines = [];\n      this.is_updating = true;\n      this.map_grid.setMatrix(numchunks, startpoint, linestosend).then(function () {\n        _this6.drawMap(_this6.canvas, startpoint, true);\n        _this6.startpoint = startpoint;\n        _this6.props.changeUpdateTime(Date.now() - start);\n        _this6.is_updating = false;\n      }).then(function () {\n        _this6.drawcache.forEach(function (draw) {\n          draw();\n        });\n      });\n      setTimeout(function () {\n        _this6.updateCanvas();\n      }, 1000);\n    } // stolen code lmao\n  }, {\n    key: \"resizeCanvas\",\n    value: function resizeCanvas(canvas) {\n      var _canvas$getBoundingCl3 = canvas.getBoundingClientRect(),\n        width = _canvas$getBoundingCl3.width,\n        height = _canvas$getBoundingCl3.height;\n      if (canvas.width !== width || canvas.height !== height) {\n        var _window = window,\n          _window$devicePixelRa = _window.devicePixelRatio,\n          ratio = _window$devicePixelRa === void 0 ? 1 : _window$devicePixelRa;\n        var context = canvas.getContext('2d');\n        canvas.width = 1 * width * ratio;\n        canvas.height = 1 * height * ratio;\n        context.scale(ratio, ratio);\n        //   canvas.style.width = `${width}px`;\n        //   canvas.style.height = `${height}px`;\n        return true;\n      }\n      return false;\n    }\n  }, {\n    key: \"drawCellAtMouse\",\n    value: function drawCellAtMouse(x, y) {\n      var currentpos = new Vector2D(x - this.celloffset.x, y - this.celloffset.y);\n      var _this$map_grid$getChu = this.map_grid.getChunkPosOffset(currentpos, this.startpoint),\n        i = _this$map_grid$getChu.i,\n        j = _this$map_grid$getChu.j,\n        k = _this$map_grid$getChu.k,\n        l = _this$map_grid$getChu.l;\n      var dataindex = this.map_grid.getDataIndex(i, j, k, l);\n      if (dataindex < this.map_grid.data.byteLength / 4) this.map_grid.addCell(dataindex, this.props.getColorSelected());\n    }\n  }, {\n    key: \"moveCursor\",\n    value: function moveCursor(event) {\n      var update = false;\n      var newcursorcurrent = this.getCursorPosition(event, this.canvas);\n      if (this.rmousedown) {\n        this.moveMap(this.cursorcurrent, newcursorcurrent);\n        update = true;\n      }\n      this.cursorcurrent = newcursorcurrent;\n      var newcurrentcell = this.getCurrentCell();\n      // Drawing line and updating stats\n      if (!this.currentcell.isEqualTo(newcurrentcell)) {\n        if (this.lmousedown) this.drawLine(this.currentcell, newcurrentcell);\n        this.currentcell = newcurrentcell;\n        this.cellpos = this.map_grid.getChunkPosOffset(this.currentcell, this.startpoint);\n        this.props.changeCursorLoc(this.currentcell);\n        this.props.changeChunkLoc(this.cellpos.i + this.startpoint.x, this.cellpos.j + this.startpoint.y);\n        update = true;\n      }\n      return update;\n    }\n  }, {\n    key: \"drawLine\",\n    value: function drawLine(p1, p2) {\n      var _this7 = this;\n      var thisdraw = function thisdraw() {\n        plotLine(p1, p2, _this7.celloffset, function (x, y) {\n          return _this7.drawCellAtMouse(x, y);\n        });\n      };\n      thisdraw();\n      if (this.is_updating) {\n        this.drawcache.push(thisdraw);\n      }\n      ;\n      this.drawLines.push({\n        p1: p1,\n        p2: p2,\n        offset: this.celloffset,\n        blockid: this.props.getColorSelected()\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this8 = this;\n      var getCursor = function getCursor() {\n        switch (_this8.props.toolmode) {\n          case EYEDROPTOOL:\n            return \"crosshair\";\n          case MOVETOOL:\n            return \"move\";\n          default:\n            return \"default\";\n        }\n      };\n      return /*#__PURE__*/React.createElement(\"div\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 798,\n          columnNumber: 17\n        }\n      }, /*#__PURE__*/React.createElement(\"canvas\", {\n        ref: this.canvasRef2,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 799,\n          columnNumber: 13\n        }\n      }), /*#__PURE__*/React.createElement(\"canvas\", {\n        ref: this.canvasRef,\n        className: \"map-canvas primary\",\n        style: {\n          cursor: getCursor()\n        },\n        onContextMenu: function onContextMenu(e) {\n          e.preventDefault();\n        },\n        onMouseDown: function onMouseDown(e) {\n          e.preventDefault();\n          if (e.button === 0) {\n            switch (_this8.props.toolmode) {\n              case EYEDROPTOOL:\n                console.log(\"eyedroptool used\");\n                var _this8$map_grid$getCh = _this8.map_grid.getChunkPosOffset(_this8.currentcell, _this8.startpoint),\n                  i = _this8$map_grid$getCh.i,\n                  j = _this8$map_grid$getCh.j,\n                  k = _this8$map_grid$getCh.k,\n                  l = _this8$map_grid$getCh.l;\n                var dataindex = _this8.map_grid.getDataIndex(i, j, k, l);\n                _this8.props.changeColor(_this8.map_grid.dataview[dataindex]);\n                // this.props.changeToolMode(DRAWTOOL);\n                break;\n              case MOVETOOL:\n                _this8.rmousedown = true;\n                break;\n              default:\n                _this8.lmousedown = true;\n                _this8.drawLine(_this8.currentcell, _this8.currentcell);\n                _this8.drawMap(_this8.canvas, _this8.startpoint);\n                break;\n            }\n          } else if (e.button === 2) {\n            _this8.rmousedown = true;\n          }\n        },\n        onMouseUp: function onMouseUp(e) {\n          _this8.lmousedown = false;\n          _this8.rmousedown = false;\n          _this8.drawMap(_this8.canvas, _this8.startpoint);\n        },\n        onMouseMove: function onMouseMove(e) {\n          if (_this8.moveCursor(e)) _this8.drawMap(_this8.canvas, _this8.startpoint);\n        },\n        onMouseLeave: function onMouseLeave(e) {\n          _this8.moveCursor(e);\n          _this8.lmousedown = false;\n          _this8.rmousedown = false;\n          _this8.drawMap(_this8.canvas, _this8.startpoint);\n        },\n        onWheel: function onWheel(e) {\n          var newscale = _this8.tempscale - Math.floor(e.deltaY) / 1000;\n          // console.log(this.scale, this.tempscale);\n          if (newscale > LOWESTSCALE) _this8.tempscale = newscale;else _this8.tempscale = LOWESTSCALE;\n          var oldscale = _this8.scale;\n          _this8.scale = Math.floor(_this8.tempscale);\n          if (oldscale !== _this8.scale) _this8.drawMap(_this8.canvas, _this8.startpoint);\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 800,\n          columnNumber: 13\n        }\n      }));\n    }\n  }]);\n  return MapCanvas;\n}(React.Component); // needs to be fixed up - maybe add useEffect()\nvar Palette = /*#__PURE__*/function (_React$Component3) {\n  _inherits(Palette, _React$Component3);\n  function Palette(props) {\n    var _this9;\n    _classCallCheck(this, Palette);\n    _this9 = _possibleConstructorReturn(this, _getPrototypeOf(Palette).call(this, props));\n    _this9.handleChange = function (e) {\n      _this9.props.changeColor(e.target.value);\n    };\n    return _this9;\n  }\n  _createClass(Palette, [{\n    key: \"render\",\n    value: function render() {\n      var _this10 = this;\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"palette primary\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 873,\n          columnNumber: 13\n        }\n      }, colors.map(function (color, index) {\n        return /*#__PURE__*/React.createElement(\"div\", {\n          key: index,\n          style: {\n            backgroundColor: \"\".concat(color)\n          },\n          className: \"blockbutton\" + (_this10.props.isSelected(color) ? \"selected\" : \"\"),\n          onClick: function onClick() {\n            _this10.props.changeColor(color);\n          }\n          //onClick={() => {console.log(button.blockid)}}\n          ,\n          __self: _this10,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 876,\n            columnNumber: 25\n          }\n        });\n      }), /*#__PURE__*/React.createElement(\"input\", {\n        value: this.props.color,\n        type: \"color\",\n        onChange: this.handleChange,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 885,\n          columnNumber: 17\n        }\n      }));\n    }\n  }]);\n  return Palette;\n}(React.Component);\nfunction App() {\n  return /*#__PURE__*/React.createElement(AppWrapper, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 898,\n      columnNumber: 5\n    }\n  });\n}\nexport default App;","map":{"version":3,"names":["React","createRef","createImageData","CHUNKSIZE","LOWESTSCALE","DRAWTOOL","EYEDROPTOOL","MOVETOOL","colors","plotLineLow","x0","y0","x1","y1","drawFunc","dx","dy","yi","D","y","x","plotLineHigh","xi","plotLine","p1","p2","offset","Math","abs","colorTo32Uint","colorstring","parseInt","substring","colorToString","colornum","toString","padStart","Vector2D","_classCallCheck","_createClass","key","value","transform","setTo","isEqualTo","othervector","notEqualTo","positive","multipliedby","number","transformedby","Map","data","dataview","numchunks","getValues","canvas","scale","chunkpixels","startpoint","floor","_canvas$getBoundingCl","getBoundingClientRect","width","height","ceil","setMatrix","dimn","start","lines","coords","map_grid","i","j","coordsobj","push","Promise","resolve","reject","fetch","method","headers","body","JSON","stringify","then","arrayBuffer","chunkbuffer","cellsize","ArrayBuffer","byteLength","Uint32Array","fill","Uint32data","k","l","bmp_index","alex_index","getDataIndex","a","b","getChunkPosOffset","currentcell","addCell","index","colorhex","AppWrapper","_React$Component","_inherits","props","_this","_possibleConstructorReturn","_getPrototypeOf","call","state","tool_mode","debug_mode","show_stats","color_selected","update","time","tot_time","num_updates","draw","cursorx","cursory","offsetx","offsety","chunkx","chunky","cxstart","cystart","cxend","cyend","getColorSelected","getDebugMode","getToolMode","changeToolMode","change_to","setState","changeColor","color","out_num","isSelected","changeUpdateTime","new_time","changeDrawTime","changeCursorLoc","vector","changeOffsetLoc","changeChunkLoc","componentDidMount","document","style","overflow","mapDownload","filename","x2","y2","response","get","split","blob","pngblob","url","window","URL","createObjectURL","link","createElement","href","setAttribute","appendChild","click","parentNode","removeChild","render","_this2","className","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber","MapCanvas","toolmode","Palette","position","right","round","onClick","checked","type","onChange","defaultValue","e","target","src","alt","Component","_React$Component2","_this3","drawLines","lastdraw","tempscale","cellpos","canvasRef","canvasRef2","mapoffset","celloffset","cursorcurrent","lmousedown","rmousedown","is_updating","drawcache","_this4","current","resizeCanvas","addEventListener","setTimeout","updateCanvas","getCursorPosition","event","rect","clientX","left","clientY","top","pos","getCurrentCell","moveMap","end","drawMap","isupdate","_this5","newCanvas","imageData","ImageData","Uint8ClampedArray","console","log","slice","bctx","getContext","putImageData","drawImage","Date","now","_canvas$getBoundingCl2","ctx","alpha","clearRect","fillStyle","fillRect","mapoffset_x","mapoffset_y","doFill","chunkbufferoffset","beginPath","lineWidth","moveTo","lineTo","c","stroke","_this6","_this$map_grid$getVal","linestosend","forEach","_canvas$getBoundingCl3","_window","_window$devicePixelRa","devicePixelRatio","ratio","context","drawCellAtMouse","currentpos","_this$map_grid$getChu","dataindex","moveCursor","newcursorcurrent","newcurrentcell","drawLine","_this7","thisdraw","blockid","_this8","getCursor","ref","cursor","onContextMenu","preventDefault","onMouseDown","button","_this8$map_grid$getCh","onMouseUp","onMouseMove","onMouseLeave","onWheel","newscale","deltaY","oldscale","_React$Component3","_this9","handleChange","_this10","map","backgroundColor","concat","App"],"sources":["/Users/alex/Programming/web_development/map_dev_server/client/src/App.js"],"sourcesContent":["import './App.css';\nimport React, { createRef } from 'react';\nimport { createImageData } from 'canvas';\n\n\nconst CHUNKSIZE = 16;\n\nconst LOWESTSCALE = 3;\n\nconst DRAWTOOL = 0;\nconst EYEDROPTOOL = 1;\nconst MOVETOOL = 2;\n  \n// const blocks = [\n//     {\n//         blockid: '0',\n//         blockname: '1',\n//         imagesrc: '#ffffff'\n//     },\n//     {\n//         blockid: '1',\n//         blockname: '2',\n//         imagesrc: '#d1e7dc'\n//     },\n//     {\n//         blockid: '2',\n//         blockname: '3',\n//         imagesrc: '#c4d4e1'\n//     },\n//     {\n//         blockid: '3',\n//         blockname: '4',\n//         imagesrc: '#bcb5d3'\n//     },\n//     {\n//         blockid: '4',\n//         blockname: '5',\n//         imagesrc: '#f5dbe2'\n//     },\n//     {\n//         blockid: '5',\n//         blockname: '6',\n//         imagesrc: '#eeb6c9'\n//     },\n//     {\n//         blockid: '6',\n//         blockname: '7',\n//         imagesrc: '#c49abf'\n//     },\n//     {\n//         blockid: '7',\n//         blockname: '8',\n//         imagesrc: '#bada55'\n//     },\n//     {\n//         blockid: '8',\n//         blockname: '9',\n//         imagesrc: '#ffd700'\n//     },\n//     {\n//         blockid: '9',\n//         blockname: '10',\n//         imagesrc: '#f47b79'\n//     },\n//     {\n//         blockid: 'a',\n//         blockname: '11',\n//         imagesrc: '#c6e2d4'\n//     },\n//     {\n//         blockid: 'b',\n//         blockname: '12',\n//         imagesrc: '#b6d3c2'\n//     },\n//     {\n//         blockid: 'c',\n//         blockname: '13',\n//         imagesrc: '#e0b1cb'\n//     },\n//     {\n//         blockid: 'd',\n//         blockname: '14',\n//         imagesrc: '#d0a7b7'\n//     },\n//     {\n//         blockid: 'e',\n//         blockname: '15',\n//         imagesrc: '#f3d1d3'\n//     },\n//     {\n//         blockid: 'f',\n//         blockname: '16',\n//         imagesrc: '#e9b8c8'\n//     }\n// ];\n\nconst colors = [\n    \"#000000\", // Black\n    \"#FFFFFF\", // White\n    \"#FF0000\", // Red\n    \"#00FF00\", // Green\n    \"#0000FF\", // Blue\n    \"#FFFF00\", // Yellow\n    \"#FF00FF\", // Magenta\n    \"#00FFFF\", // Cyan\n    \"#800000\", // Maroon\n    \"#008000\", // Olive\n    \"#000080\", // Navy\n    \"#808000\", // Olive Drab\n    \"#800080\", // Purple\n    \"#008080\", // Teal\n    \"#808080\", // Gray\n    \"#C0C0C0\", // Silver\n    \"#FFC0CB\", // Pink\n    \"#FFA07A\", // Light Salmon\n    \"#FF7F50\", // Coral\n    \"#FF6347\", // Tomato\n    \"#FF4500\", // Orange Red\n    \"#FF8C00\", // Dark Orange\n    \"#FFD700\", // Gold\n    \"#FFFFE0\", // Light Yellow\n    \"#EEE8AA\", // Pale Goldenrod\n    \"#ADFF2F\", // Green Yellow\n    \"#32CD32\", // Lime Green\n    \"#00FA9A\", // Medium Spring Green\n    \"#00CED1\", // Dark Turquoise\n    \"#6A5ACD\", // Slate Blue\n    \"#7B68EE\", // Medium Slate Blue\n    \"#FF69B4\", // Hot Pink\n    \"#8B4513\" // Saddle Brown\n  ];\n  \n\n\nfunction plotLineLow(x0, y0, x1, y1, drawFunc) {\n    let dx = x1 - x0;\n    let dy = y1 - y0;\n    let yi = 1;\n    if (dy < 0) {\n        yi = -1;\n        dy = -dy;\n    }\n    let D = (2 * dy) - dx;\n    let y = y0;\n\n    for (let x = x0;x<x1+1;x++) {\n        drawFunc(x, y);\n        if (D > 0) {\n            y = y + yi;\n            D = D + (2 * (dy - dx));\n        } else {\n            D = D + 2*dy;\n        }\n    }\n}\nfunction plotLineHigh(x0, y0, x1, y1, drawFunc) {\n    let dx = x1 - x0;\n    let dy = y1 - y0;\n    let xi = 1;\n    if (dx < 0) {\n        xi = -1;\n        dx = -dx;\n    }\n    let D = (2 * dx) - dy;\n    let x = x0;\n\n    for (let y = y0;y<y1+1;y++) {\n        drawFunc(x, y);\n        if (D > 0) {\n            x = x + xi;\n            D = D + (2 * (dx - dy));\n        } else {\n            D = D + 2*dx;\n        }\n    }\n}\n\nfunction plotLine(p1, p2, offset, drawFunc) {\n    \n    let x0 = p1.x+offset.x;\n    let y0 = p1.y+offset.y;\n    \n    let x1 = p2.x+offset.x;\n    let y1 = p2.y+offset.y;\n\n    if (x0===x1 && y0===y1) drawFunc(x0,y0);\n\n\n    if (Math.abs(y1 - y0) < Math.abs(x1 - x0)) {\n        if (x0 > x1) plotLineLow(x1, y1, x0, y0, drawFunc);\n        else plotLineLow(x0, y0, x1, y1, drawFunc);\n    }\n    else {\n        if (y0 > y1) plotLineHigh(x1, y1, x0, y0, drawFunc);\n        else plotLineHigh(x0, y0, x1, y1, drawFunc);\n    }\n}\n\n\nfunction colorTo32Uint(colorstring) {\n    return parseInt(colorstring.substring(1), 16);\n}\nfunction colorToString(colornum) {\n    return \"#\" + (colornum & 0x00FFFFFF).toString(16).padStart(6, '0');\n}\n\nclass Vector2D {\n    constructor(x,y) {\n        this.x = x;\n        this.y = y;\n    }\n\n    transform(x,y) {\n        this.x += x;\n        this.y += y;\n    }\n\n    setTo(x,y) {\n        this.x = x;\n        this.y = y;\n    }\n\n    isEqualTo(othervector) {\n        return (this.x===othervector.x && this.y===othervector.y);\n    }\n    notEqualTo(othervector) {\n        return (this.x!==othervector.x || this.y!==othervector.y);\n    }\n\n    positive() {\n        return (this.x >= 0 && this.y >=0);\n    }\n\n    multipliedby(number) {\n        return new Vector2D(this.x*number,this.y*number);\n    }\n    transformedby(x,y) {\n        return new Vector2D(this.x+x,this.y+y);\n    }\n}\n\n\nclass Map {\n    constructor() {\n        // this.canvasdimensions = new Vector2D(w,h); // establishing at start means no resizing canvas element\n        this.data = null;\n        this.dataview = null;\n        this.numchunks = null;\n    }\n\n    getValues(canvas, offset, scale) {\n        let chunkpixels = CHUNKSIZE*scale;\n\n        let numchunks = new Vector2D(0,0);\n        let startpoint = new Vector2D(0,0);\n\n        startpoint.x = (offset.x === 0) ? 0 : Math.floor((-1*offset.x)/chunkpixels);\n        startpoint.y = (offset.y === 0) ? 0 : Math.floor((-1*offset.y)/chunkpixels);\n\n        const { width, height } = canvas.getBoundingClientRect();\n\n        numchunks.x = Math.ceil(width/chunkpixels)+1; // bit cheaty - should probs optimise\n        numchunks.y = Math.ceil(height/chunkpixels)+1;\n\n        return {startpoint, numchunks};\n    }\n\n    setMatrix(dimn, start, lines) {\n\n        let coords = [];\n        let map_grid = this;\n\n        for (let i=0;i<dimn.x;i++) {\n            for (let j=0;j<dimn.y;j++) {\n                let coordsobj = { x: start.x+i, y: start.y+j };\n                coords.push(coordsobj);    \n            }\n        }\n        return new Promise(function(resolve, reject) {\n            fetch('/getchunks',{\n                method: 'POST',\n                headers: {'Accept': 'application/octet-stream', 'Content-Type': 'application/json'},\n                body: JSON.stringify({coords:coords, lines:lines})\n            }).then((data)=>{\n                return data.arrayBuffer();\n            }).then((chunkbuffer) => {\n                // console.log([...new Uint8Array(chunkbuffer)].map(x => x.toString(16).padStart(2, '0')));\n                // map_grid.data = chunkbuffer;\n                // map_grid.dataview = new Uint32Array(map_grid.data);\n                map_grid.numchunks = dimn;\n\n\n                const cellsize = 5;\n                map_grid.data = new ArrayBuffer(chunkbuffer.byteLength*cellsize*cellsize)\n                map_grid.dataview = new Uint32Array(map_grid.data).fill(4294967295);\n\n                let Uint32data = new Uint32Array(chunkbuffer);\n                // console.log(new Uint8Array(chunkbuffer));\n                \n                // for (let i=0;i<map_grid.numchunks.x;i++) {\n                //     for (let j=0;j<map_grid.numchunks.y;j++) {\n                //         for (let k=0;k<CHUNKSIZE;k++) {\n                //             for (let l=0;l<CHUNKSIZE;l++) {\n                //                 let bmp_index = i*CHUNKSIZE+j*map_grid.numchunks.x*(CHUNKSIZE*CHUNKSIZE)+k+l* map_grid.numchunks.x*CHUNKSIZE;\n                //                 let alex_index = map_grid.getDataIndex(i,j,k,l);\n                //                 map_grid.dataview[bmp_index] = Uint32data[alex_index];\n                //             }\n                //         }\n                //     }\n                // }\n                for (let i=0;i<map_grid.numchunks.x;i++) {\n                    for (let j=0;j<map_grid.numchunks.y;j++) {\n                        for (let k=0;k<CHUNKSIZE;k++) {\n                            for (let l=0;l<CHUNKSIZE;l++) {\n                                let bmp_index = i*CHUNKSIZE + j*map_grid.numchunks.x*(CHUNKSIZE*CHUNKSIZE)*cellsize + k + l*map_grid.numchunks.x*CHUNKSIZE*cellsize;\n                                let alex_index = map_grid.getDataIndex(i,j,k,l);\n                                // map_grid.dataview[bmp_index] = Uint32data[alex_index];\n                                // bmp_index*=cellsize;\n                                for (let a=0;a<cellsize;a++) {\n                                    for (let b=0;b<cellsize;b++) {\n                                        // if (a===1&&b===0) bmp_index+=2;\n                                        // bmp_index+=a;\n                                        // if (a==0&&b==0) bmp_index+=a+b*map_grid.numchunks.x*CHUNKSIZE*cellsize;\n                                        // bmp_index += a + b*map_grid.numchunks.x*cellsize*cellsize;\n                                        // let bmp_index = i*CHUNKSIZE*cellsize+j*map_grid.numchunks.x*(CHUNKSIZE*CHUNKSIZE)*cellsize*cellsize+(k*cellsize+a)+(l*cellsize*cellsize+b)*map_grid.numchunks.x*CHUNKSIZE;\n                                        map_grid.dataview[bmp_index] = Uint32data[alex_index];\n                                    }\n                                }\n                            }\n                        }\n                    }\n                }\n\n\n\n\n\n                resolve();\n            });\n        });\n    }\n\n    getChunkPosOffset(currentcell, startpoint) {\n        const i = Math.floor((currentcell.x/CHUNKSIZE))-startpoint.x;\n        const k = currentcell.x - (i+startpoint.x)*CHUNKSIZE;\n\n        const j = Math.floor((currentcell.y/CHUNKSIZE))-startpoint.y;\n        const l = currentcell.y - (j+startpoint.y)*CHUNKSIZE;\n\n\n        return {i, j, k, l};\n    }\n\n    addCell(index,colorhex) {\n        this.dataview[index] = colorhex;\n        // console.log(data[index], colorhex);\n    }\n    getDataIndex(i,j,k,l) {\n        return i*(this.numchunks.y)*(CHUNKSIZE*CHUNKSIZE)+j*(CHUNKSIZE*CHUNKSIZE)+k*CHUNKSIZE+l;\n    }\n}\n\n\nclass AppWrapper extends React.Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            tool_mode: MOVETOOL,\n            debug_mode: false,\n            show_stats: true,\n            color_selected: 1672153, \n            update: {\n                time: 0,\n                tot_time: 0,\n                num_updates: 1\n            },\n            draw: {\n                time: 0,\n                tot_time: 0,\n                num_updates: 1\n            },\n            cursorx: 0,\n            cursory: 0,\n            offsetx: 0,\n            offsety: 0,\n            chunkx: 0,\n            chunky: 0,\n\n            cxstart:0,\n            cystart:0,\n            cxend:0,\n            cyend:0\n        };\n\n        this.getColorSelected = () => {return this.state.color_selected};\n        this.getDebugMode = () => {return this.state.debug_mode};\n        this.getToolMode = () => {return this.state.tool_mode};\n\n        this.changeToolMode = (change_to) => {\n            this.setState({tool_mode: change_to});\n        }\n\n        this.changeColor = (color) => {\n            if (typeof color === 'string') {\n                let out_num = colorTo32Uint(color);\n                this.setState({color_selected: out_num});\n            }\n            else if (typeof color === 'number') {\n                this.setState({color_selected: color});\n            }\n            this.changeToolMode(DRAWTOOL);\n        };\n        this.isSelected = (color) => {\n            if (typeof color === 'string') {\n                let out_num = colorTo32Uint(color);\n                return (out_num===this.state.color_selected);\n            }\n            else if (typeof color === 'number') {\n                return (color===this.state.color_selected);\n            }\n        };\n\n        this.changeUpdateTime = (new_time) => {\n            this.setState({update:{\n                time: new_time, \n                tot_time: this.state.update.tot_time+new_time, \n                num_updates: this.state.update.num_updates+1\n            }});\n        }\n        this.changeDrawTime = (new_time) => {\n            this.setState({draw:{\n                time: new_time, \n                tot_time: this.state.draw.tot_time+new_time, \n                num_updates: this.state.draw.num_updates+1\n            }});\n        }\n        this.changeCursorLoc = (vector) => {\n            this.setState({cursorx: vector.x,cursory: vector.y});\n        }\n        this.changeOffsetLoc = (vector) => {\n            this.setState({offsetx: vector.x,offsety: vector.y});\n        }\n        this.changeChunkLoc = (x,y) => {\n            this.setState({chunkx: x,chunky: y});\n        }\n    }\n\n    componentDidMount() {\n        document.body.style.overflow = \"hidden\"; // stops user from scrolling the page\n    }\n\n    mapDownload() {\n        let filename;\n        let coordsobj = {x1:this.state.cxstart,y1:this.state.cystart,x2:this.state.cxend,y2:this.state.cyend};\n        if (coordsobj.x1===coordsobj.x2 || coordsobj.y1===coordsobj.y2 || coordsobj.x1>coordsobj.x2 || coordsobj.y1>coordsobj.y2) return;\n\n        fetch('/getimage',{\n            method: 'POST',\n            headers: {'Accept': 'application/octet-stream', 'Content-Type': 'application/json'},\n            body: JSON.stringify(coordsobj)\n        }).then((response) => {\n            filename = response.headers.get('Content-Disposition').split('\"')[1];\n            return response.blob()\n        })\n        .then((pngblob) => {\n            const url = window.URL.createObjectURL(pngblob);\n            const link = document.createElement('a');\n            link.href = url;\n            link.setAttribute('download',filename);\n            document.body.appendChild(link);\n            link.click();\n            link.parentNode.removeChild(link);\n        });\n    }\n\n    render() {\n        return (\n            <div className='App-wrapper'>\n                <MapCanvas \n                    toolmode={this.state.tool_mode}\n                    getToolMode={this.getToolMode}\n                    changeToolMode={this.changeToolMode}\n                    getDebugMode={this.getDebugMode}\n                    changeUpdateTime={this.changeUpdateTime}\n                    changeDrawTime={this.changeDrawTime}\n                    getColorSelected={this.getColorSelected}\n                    changeCursorLoc={this.changeCursorLoc}\n                    changeOffsetLoc={this.changeOffsetLoc}\n                    changeChunkLoc={this.changeChunkLoc}\n                    changeColor={this.changeColor}\n                />\n                <Palette isSelected={this.isSelected} changeColor={this.changeColor} color={this.state.color_selected}/>\n                <div className='drawer primary'>\n                    {(this.state.show_stats)?(<div style={{position: `absolute`,right:`0.8vw`}}>\n                        ({this.state.update.time}ms, avg: {Math.round(this.state.update.tot_time/this.state.update.num_updates)}ms, {this.state.update.num_updates} updates)\n                        <br/>({this.state.draw.time}ms, avg: {Math.round(this.state.draw.tot_time/this.state.draw.num_updates)}ms, {this.state.draw.num_updates} draws)\n                        <br/>Cursor: ({this.state.cursorx},{this.state.cursory})\n                        <br/>Offset: ({this.state.offsetx},{this.state.offsety})\n                        <br/>Chunk: ({this.state.chunkx},{this.state.chunky})\n                    </div>):null}\n\n                    <div\n                        className={`toolbutton` + (this.getToolMode()===DRAWTOOL ? \"selected\" : \"\")+ ` blockbutton` + (this.getToolMode()===DRAWTOOL ? \"selected\" : \"\")}\n                        onClick={() => {this.changeToolMode(DRAWTOOL)}}\n                    >draw</div>\n                    <div\n                        className={`toolbutton` + (this.getToolMode()===EYEDROPTOOL ? \"selected\" : \"\")+ ` blockbutton` + (this.getToolMode()===EYEDROPTOOL ? \"selected\" : \"\")}\n                        onClick={() => {this.changeToolMode(EYEDROPTOOL)}}\n                    >eyedrop</div>\n                    <div\n                        className={`toolbutton` + (this.getToolMode()===MOVETOOL ? \"selected\" : \"\")+ ` blockbutton` + (this.getToolMode()===MOVETOOL ? \"selected\" : \"\")}\n                        onClick={() => {this.changeToolMode(MOVETOOL)}}\n                    >move</div>\n                    \n\n                    <input checked={this.state.debug_mode} type={\"checkbox\"} onChange={()=>{this.setState({debug_mode:!this.state.debug_mode})}}></input> Debug Mode&ensp;\n                    <input checked={this.state.show_stats} type={\"checkbox\"} onChange={()=>{this.setState({show_stats:!this.state.show_stats})}}></input> Stats\n                    <table\n                        className={`download-wrapper`}\n                        // onClick={() => this.fileDownload()}\n                    ><tbody>\n                        <tr>\n                            <td>\n                                <p>from:&nbsp;</p><input defaultValue={\"0\"} type={\"number\"} style={{width:\"35px\"}} onChange={(e)=>this.setState({cxstart:parseInt(e.target.value)})}></input>\n                                <input defaultValue={\"0\"} type={\"number\"} style={{width:\"35px\"}} onChange={(e)=>this.setState({cystart:parseInt(e.target.value)})}></input>\n                            </td>\n                        </tr>\n                        <tr>\n                            <td>\n                                <p>to:&nbsp;</p><input defaultValue={\"0\"} type={\"number\"} style={{width:\"35px\"}} onChange={(e)=>this.setState({cxend:parseInt(e.target.value)})}></input>\n                                <input defaultValue={\"0\"} type={\"number\"} style={{width:\"35px\"}} onChange={(e)=>this.setState({cyend:parseInt(e.target.value)})}></input>\n                            </td>\n                        </tr>\n                        <tr>\n                            <td>\n                                <p >Save PNG:</p>\n                                <div className={`download-button`} onClick={() => this.mapDownload()}><img src='save.png' alt='save'/></div>\n                            </td>\n                        </tr>\n                    </tbody></table>\n                </div>\n            </div>\n        )\n    }\n}\n\nclass MapCanvas extends React.Component {\n    constructor(props) {\n        super(props);\n\n        this.drawLines = [];\n\n        this.lastdraw = 0;\n\n        this.scale = 16;\n        this.tempscale = this.scale;\n\n        this.cellpos = {i:0,j:0,k:0,l:0};\n\n        this.map_grid = null;\n        this.canvasRef = createRef();\n        this.canvasRef2 = createRef();\n    \n        this.mapoffset = new Vector2D(0,0);\n        this.celloffset = new Vector2D(0,0);\n        this.currentcell = new Vector2D(0,0);\n        this.startpoint = new Vector2D(0,0);\n\n        this.cursorcurrent = new Vector2D(0,0);\n        this.lmousedown = false;\n        this.rmousedown = false;\n\n        this.canvas = null;\n\n        this.is_updating = false;\n        this.drawcache = [];\n    }\n\n\n    //Called after element's initialisation\n    componentDidMount() { \n        this.canvas = this.canvasRef.current;\n        this.map_grid = new Map();\n        this.resizeCanvas(this.canvas);\n        window.addEventListener('resize', ()=>this.resizeCanvas(this.canvas));\n        setTimeout(this.updateCanvas(), 1000);\n    }\n\n    getCursorPosition(event, canvas) {\n        const rect = canvas.getBoundingClientRect();\n        const x = event.clientX - rect.left;\n        const y = event.clientY - rect.top;\n        const pos = new Vector2D(x,y);\n        return pos;\n    }\n\n    getCurrentCell() {\n        let x = Math.floor((this.cursorcurrent.x-this.mapoffset.x*this.scale)/(this.scale));\n        let y = Math.floor((this.cursorcurrent.y-this.mapoffset.y*this.scale)/(this.scale));\n        const pos = new Vector2D(x,y);\n        return pos;\n    }\n\n    moveMap(start, end) {\n        let x = (end.x-start.x)/this.scale;\n        let y = (end.y-start.y)/this.scale;\n        this.mapoffset.transform(x,y);\n        this.celloffset.setTo(Math.floor(this.mapoffset.x),Math.floor(this.mapoffset.y));\n        this.props.changeOffsetLoc(this.celloffset);\n    }\n\n    drawMap (canvas, startpoint, isupdate) {\n        if (this.map_grid.data===null || this.map_grid.numchunks===null) return;\n\n        // let blob = new Blob([this.map_grid.data]);\n        // console.log(blob);\n\n        var newCanvas = this.canvasRef2.current;\n        newCanvas.width = 400;\n        newCanvas.height = 400;\n        // console.log(newCanvas.width, newCanvas.height);\n\n        let imageData = new ImageData(new Uint8ClampedArray(this.map_grid.data), this.map_grid.numchunks.x*CHUNKSIZE*5);\n        // let imageData = createImageData(new Uint8ClampedArray(this.map_grid.data), this.map_grid.numchunks.x*CHUNKSIZE*CHUNKSIZE);\n        console.log(imageData);\n        console.log(imageData.data.slice(6400*4-1));\n        const bctx = canvas.getContext(\"2d\");\n        // bctx.transferFromImageData(bitmap);\n        newCanvas.getContext(\"2d\").putImageData(imageData, 0, 0);\n        // bctx.scale(1.1,1.1);\n        bctx.drawImage(newCanvas, 0, 0);        \n        return;\n\n\n        let start =  Date.now();\n\n        // if (start < (this.lastdraw + 1000/60)) return; // Only drawing every 1/60th of a second\n        this.lastdraw = start;\n\n        const { width, height } = canvas.getBoundingClientRect();\n        const ctx = canvas.getContext(\"2d\", { alpha: false });\n        \n        ctx.clearRect(0, 0, width, height)\n        ctx.fillStyle = \"#ffffff\";\n        ctx.fillRect(0, 0, width, height);\n\n\n        // finding location in terms of iterators of current cell\n        // let {cell_i, cell_j, cell_k, cell_l} = this.map_grid.getChunkPosOffset(this.currentcell, startpoint);\n\n        let colornum;\n        let x;\n        let y;\n\n        let mapoffset_x = Math.floor(this.mapoffset.x*this.scale);\n        let mapoffset_y = Math.floor(this.mapoffset.y*this.scale);\n        // let mapoffset_x = this.mapoffset.x;\n        // let mapoffset_y = this.mapoffset.y;\n\n        let doFill = (i,j,k,l) => {\n\n            x = (((i+startpoint.x)*CHUNKSIZE+k))*(this.scale)+mapoffset_x;\n            y = (((j+startpoint.y)*CHUNKSIZE+l))*(this.scale)+mapoffset_y;\n            if (x%1!==0||y%1!==0||this.scale%1!==0) console.log(\"ALERT:\", x, y, this.scale);\n            ctx.fillRect(x, y, this.scale, this.scale);\n            // console.log(x,y,cellapparentsize);\n        }\n        if (this.map_grid.data === null) return;\n        // for map\n\n\n        let chunkbufferoffset = 0;\n\n        if (this.props.getDebugMode()) ctx.beginPath();\n        for (let i=0;i<this.map_grid.numchunks.x;i++) {\n            for (let j=0;j<this.map_grid.numchunks.y;j++) {\n                // for each chunk\n                if (this.props.getDebugMode()) {\n                    x = (((i+startpoint.x)*CHUNKSIZE))*(this.scale)+mapoffset_x;\n                    y = (((j+startpoint.y)*CHUNKSIZE))*(this.scale)+mapoffset_y;\n\n                    ctx.fillStyle = \"#000000\";\n                    ctx.lineWidth = 0.01*Math.floor(this.scale);\n                    ctx.moveTo(x, 0);\n                    ctx.lineTo(x, height);\n                    // ctx.stroke();\n                    ctx.moveTo(0, y);\n                    ctx.lineTo(width, y);\n                }\n                for (let c=0;c<(CHUNKSIZE*CHUNKSIZE);c++) {\n                    let k = Math.floor(c/CHUNKSIZE);\n                    let l = c-(k*CHUNKSIZE);\n                    \n                    colornum = this.map_grid.dataview[chunkbufferoffset+c];\n\n                    if (colornum!==16777215){\n                        ctx.fillStyle = colorToString(colornum);\n                        doFill(i,j,k,l);\n                    }\n                }\n                chunkbufferoffset += (CHUNKSIZE*CHUNKSIZE);\n            }\n        }\n        if (this.props.getDebugMode()) ctx.stroke();\n\n        if (this.props.toolmode===DRAWTOOL) {\n            ctx.fillStyle = colorToString(this.props.getColorSelected())+\"ff\";\n            doFill(this.cellpos.i,this.cellpos.j,this.cellpos.k,this.cellpos.l);\n        }\n        this.props.changeDrawTime(Date.now()-start);\n    }\n\n    updateCanvas() {\n        let start = Date.now(); // time testing\n\n        let {startpoint, numchunks} = this.map_grid.getValues(this.canvas, this.mapoffset.multipliedby(this.scale), this.scale);\n        let linestosend = this.drawLines;\n        this.drawLines = [];\n        this.is_updating = true;\n        this.map_grid.setMatrix(numchunks, startpoint, linestosend)\n        .then(()=>{\n            this.drawMap(this.canvas, startpoint, true);\n            this.startpoint = startpoint;\n            this.props.changeUpdateTime(Date.now()-start);\n            this.is_updating = false;\n        }).then(()=>{\n            this.drawcache.forEach((draw) => {draw()});\n        });\n\n        setTimeout(()=>{this.updateCanvas()}, 1000);\n    }\n\n    // stolen code lmao\n    resizeCanvas(canvas) {\n        const { width, height } = canvas.getBoundingClientRect();\n        \n        if (canvas.width !== width || canvas.height !== height) {\n          const { devicePixelRatio:ratio=1 } = window;\n          const context = canvas.getContext('2d');\n          canvas.width = (1*width*ratio);\n          canvas.height = (1*height*ratio);\n          context.scale(ratio, ratio);\n        //   canvas.style.width = `${width}px`;\n        //   canvas.style.height = `${height}px`;\n          return true;\n        }\n    \n        return false\n    }\n\n    drawCellAtMouse(x,y) {\n        const currentpos = new Vector2D(x-this.celloffset.x,y-this.celloffset.y);\n\n        let {i, j, k, l} = this.map_grid.getChunkPosOffset(currentpos, this.startpoint);\n        let dataindex = this.map_grid.getDataIndex(i,j,k,l);\n        if (dataindex < this.map_grid.data.byteLength/4) this.map_grid.addCell(dataindex, this.props.getColorSelected());\n    }\n\n    moveCursor(event) {\n        let update = false;\n        let newcursorcurrent = this.getCursorPosition(event, this.canvas);\n        if (this.rmousedown) {\n            this.moveMap(this.cursorcurrent, newcursorcurrent);\n            update = true;\n        }\n        this.cursorcurrent = newcursorcurrent;\n        let newcurrentcell = this.getCurrentCell();\n        // Drawing line and updating stats\n        if (!this.currentcell.isEqualTo(newcurrentcell)) {\n            if (this.lmousedown) this.drawLine(this.currentcell,newcurrentcell);\n            this.currentcell = newcurrentcell;\n            this.cellpos = this.map_grid.getChunkPosOffset(this.currentcell, this.startpoint);\n            this.props.changeCursorLoc(this.currentcell);\n            this.props.changeChunkLoc(this.cellpos.i+this.startpoint.x,this.cellpos.j+this.startpoint.y);\n            update = true;\n        }\n        return update;\n    }\n\n    drawLine(p1,p2) {\n        let thisdraw = ()=>{plotLine(p1, p2, this.celloffset, (x,y)=>this.drawCellAtMouse(x,y))};\n        thisdraw();\n        if (this.is_updating) {this.drawcache.push(thisdraw)};\n        this.drawLines.push({p1:p1,p2:p2,offset:this.celloffset,blockid:this.props.getColorSelected()});\n    }\n\n    render() {\n        let getCursor = ()=>{\n            switch (this.props.toolmode) {\n                case EYEDROPTOOL:\n                    return \"crosshair\";\n                case MOVETOOL:\n                    return \"move\";\n                default:\n                    return \"default\";\n            }\n        }\n        return (<div>\n            <canvas ref={this.canvasRef2}></canvas>\n            <canvas \n                ref={this.canvasRef}\n                className='map-canvas primary'\n                style={{cursor:getCursor()}}\n                onContextMenu={(e) => {\n                    e.preventDefault();\n                }}\n                onMouseDown={(e) => {\n                    e.preventDefault();\n                    if (e.button === 0) {\n                        switch (this.props.toolmode) {\n                            case EYEDROPTOOL:\n                                console.log(\"eyedroptool used\");\n                                let {i,j,k,l} = this.map_grid.getChunkPosOffset(this.currentcell, this.startpoint);\n                                let dataindex = this.map_grid.getDataIndex(i,j,k,l);\n                                this.props.changeColor(this.map_grid.dataview[dataindex]);\n                                // this.props.changeToolMode(DRAWTOOL);\n                                break;\n                            case MOVETOOL:\n                                this.rmousedown=true;\n                                break;\n                            default:\n                                this.lmousedown=true;\n                                this.drawLine(this.currentcell,this.currentcell);\n                                this.drawMap(this.canvas, this.startpoint);\n                                break;\n                        }\n                    }\n                    else if (e.button === 2) {\n                        this.rmousedown=true;\n                    }\n                }}\n                onMouseUp={(e) => {\n                    this.lmousedown=false;\n                    this.rmousedown=false;\n                    this.drawMap(this.canvas, this.startpoint);\n                }}\n                onMouseMove={(e) => {\n                    if (this.moveCursor(e)) this.drawMap(this.canvas, this.startpoint);\n                }}\n                onMouseLeave={(e) => {\n                    this.moveCursor(e);\n                    this.lmousedown=false;\n                    this.rmousedown=false;\n                    this.drawMap(this.canvas, this.startpoint);\n                }}\n                onWheel={(e) => {\n                    let newscale = this.tempscale - Math.floor(e.deltaY)/1000;\n                    // console.log(this.scale, this.tempscale);\n                    if (newscale>LOWESTSCALE) this.tempscale = newscale;\n                    else this.tempscale = LOWESTSCALE;\n                    let oldscale = this.scale;\n                    this.scale = Math.floor(this.tempscale);\n                    \n                    if (oldscale!==this.scale) this.drawMap(this.canvas, this.startpoint);\n                }}\n            ></canvas></div>\n        )\n    }\n}\n\n// needs to be fixed up - maybe add useEffect()\nclass Palette extends React.Component {\n    constructor(props) {\n        super(props);\n\n        this.handleChange = (e) => {\n            this.props.changeColor(e.target.value);\n        }\n    }\n\n    render() {\n        return (\n            <div className='palette primary'>\n                {\n                    colors.map((color,index) => (\n                        <div \n                            key={index} \n                            style={{backgroundColor: `${color}`}} \n                            className={`blockbutton` + (this.props.isSelected(color) ? \"selected\" : \"\")}\n                            onClick={() => {this.props.changeColor(color);}}\n                            //onClick={() => {console.log(button.blockid)}}\n                            ></div>\n                    ))\n                }\n                <input value={this.props.color} type={\"color\"} onChange={this.handleChange} ></input>\n                {/* <input type={\"submit\"} value={\"Apply\"}></input> */}\n        </div>\n        )\n    }\n\n}\n\n\n\n\nfunction App() {\n  return (\n    <AppWrapper/>\n  );\n}\n\nexport default App;\n"],"mappings":";;;;;;AAAA,OAAO,WAAW;AAClB,OAAOA,KAAK,IAAIC,SAAS,QAAQ,OAAO;AACxC,SAASC,eAAe,QAAQ,QAAQ;AAGxC,IAAMC,SAAS,GAAG,EAAE;AAEpB,IAAMC,WAAW,GAAG,CAAC;AAErB,IAAMC,QAAQ,GAAG,CAAC;AAClB,IAAMC,WAAW,GAAG,CAAC;AACrB,IAAMC,QAAQ,GAAG,CAAC;;AAElB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,IAAMC,MAAM,GAAG,CACX,SAAS;AAAE;AACX,SAAS;AAAE;AACX,SAAS;AAAE;AACX,SAAS;AAAE;AACX,SAAS;AAAE;AACX,SAAS;AAAE;AACX,SAAS;AAAE;AACX,SAAS;AAAE;AACX,SAAS;AAAE;AACX,SAAS;AAAE;AACX,SAAS;AAAE;AACX,SAAS;AAAE;AACX,SAAS;AAAE;AACX,SAAS;AAAE;AACX,SAAS;AAAE;AACX,SAAS;AAAE;AACX,SAAS;AAAE;AACX,SAAS;AAAE;AACX,SAAS;AAAE;AACX,SAAS;AAAE;AACX,SAAS;AAAE;AACX,SAAS;AAAE;AACX,SAAS;AAAE;AACX,SAAS;AAAE;AACX,SAAS;AAAE;AACX,SAAS;AAAE;AACX,SAAS;AAAE;AACX,SAAS;AAAE;AACX,SAAS;AAAE;AACX,SAAS;AAAE;AACX,SAAS;AAAE;AACX,SAAS;AAAE;AACX,SAAS,CAAC;AAAA,CACX;;AAIH,SAASC,WAAWA,CAACC,EAAE,EAAEC,EAAE,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"},"metadata":{},"sourceType":"module"}